<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.20">
<meta name="author" content="Cloud-native network functions best practices for Far Edge applications">
<link rel="icon" type="image/x-icon" href="assets/img/favicon.ico">
<title>CNF Best Practices for Far Edge Applications</title>
<style>
/*! normalize.css v2.1.2 | MIT License | git.io/normalize */
@import url("https://fonts.googleapis.com/css2?family=Roboto:wght@100;200;300;400;500;600;700;800;900&display=swap");
@import url(https://fonts.googleapis.com/css?family=Lato:400,700,700italic,400italic);
@import url("https://fonts.googleapis.com/css2?family=Inconsolata:wght@200;300;400;500;600;700;800;900&display=swap");

article,
aside,
details,
figcaption,
figure,
footer,
header,
hgroup,
main,
nav,
section,
summary {
    display: block
}

audio,
canvas,
video {
    display: inline-block
}

audio:not([controls]) {
    display: none;
    height: 0
}

[hidden],
template {
    display: none
}

script {
    display: none !important
}

html {
    font-family: sans-serif;
    -ms-text-size-adjust: 100%;
    -webkit-text-size-adjust: 100%;
    scroll-behavior: smooth;
}

body {
    margin: 0;
}

a {
    background: transparent;
}

a:focus {
    outline: thin dotted
}

a:active,
a:hover {
    outline: 0
}

h1 {
    font-size: 2em;
    margin: 0.67em 0
}

abbr[title] {
    border-bottom: 1px dotted
}

b,
strong {
    font-weight: bold
}

dfn {
    font-style: italic
}

hr {
    -moz-box-sizing: content-box;
    box-sizing: content-box;
    height: 0
}

mark {
    background: #ff0;
    color: #000
}

code,
kbd,
pre,
samp {
    font-family: monospace, serif;
    font-size: 1em
}

pre {
    white-space: pre-wrap
}

q {
    quotes: "\201C""\201D""\2018""\2019"
}

small {
    font-size: 80%
}

sub,
sup {
    font-size: 75%;
    line-height: 0;
    position: relative;
    vertical-align: baseline
}

sup {
    top: -0.5em
}

sub {
    bottom: -0.25em
}

img {
    border: 0
}

svg:not(:root) {
    overflow: hidden
}

figure {
    margin: 0
}

fieldset {
    border: 1px solid #c0c0c0;
    margin: 0 2px;
    padding: 0.35em 0.625em 0.75em
}

legend {
    border: 0;
    padding: 0
}

button,
input,
select,
textarea {
    font-family: inherit;
    font-size: 100%;
    margin: 0
}

button,
input {
    line-height: normal
}

button,
select {
    text-transform: none
}

button,
html input[type="button"],
input[type="reset"],
input[type="submit"] {
    -webkit-appearance: button;
    cursor: pointer
}

button[disabled],
html input[disabled] {
    cursor: default
}

input[type="checkbox"],
input[type="radio"] {
    box-sizing: border-box;
    padding: 0
}

input[type="search"] {
    -webkit-appearance: textfield;
    -moz-box-sizing: content-box;
    -webkit-box-sizing: content-box;
    box-sizing: content-box
}

input[type="search"]::-webkit-search-cancel-button,
input[type="search"]::-webkit-search-decoration {
    -webkit-appearance: none
}

button::-moz-focus-inner,
input::-moz-focus-inner {
    border: 0;
    padding: 0
}

textarea {
    overflow: auto;
    vertical-align: top
}

table {
    border-collapse: collapse;
    border-spacing: 0
}

meta.foundation-mq-small {
    font-family: "only screen and (min-width: 768px)";
    width: 768px
}

meta.foundation-mq-medium {
    font-family: "only screen and (min-width:1280px)";
    width: 1280px
}

meta.foundation-mq-large {
    font-family: "only screen and (min-width:1440px)";
    width: 1440px
}

*,
*:before,
*:after {
    -moz-box-sizing: border-box;
    -webkit-box-sizing: border-box;
    box-sizing: border-box
}

html,
body {
    font-size: 100%
}

body {
    background: #fff;
    color: #222;
    padding: 0;
    margin: 0;
    font-family: "Helvetica Neue", "Helvetica", Helvetica, Arial, sans-serif;
    font-weight: normal;
    font-style: normal;
    line-height: 1;
    position: relative;
    cursor: auto
}

a:hover {
    cursor: pointer
}

img,
object,
embed {
    max-width: 100%;
    height: auto
}

object,
embed {
    height: 100%
}

img {
    -ms-interpolation-mode: bicubic
}

#map_canvas img,
#map_canvas embed,
#map_canvas object,
.map_canvas img,
.map_canvas embed,
.map_canvas object {
    max-width: none !important
}

.left {
    float: left !important
}

.right {
    float: right !important
}

.text-left {
    text-align: left !important
}

.text-right {
    text-align: right !important
}

.text-center {
    text-align: center !important
}

.text-justify {
    text-align: justify !important
}

.hide {
    display: none
}

.antialiased {
    -webkit-font-smoothing: antialiased
}

img {
    display: inline-block;
    vertical-align: middle
}

textarea {
    height: auto;
    min-height: 50px
}

select {
    width: 100%
}

p.lead {
    font-size: 1.21875em;
    line-height: 1.6
}

.subheader,
.admonitionblock td.content>.title,
.audioblock>.title,
.exampleblock>.title,
.imageblock>.title,
.listingblock>.title,
.literalblock>.title,
.stemblock>.title,
.openblock>.title,
.paragraph>.title,
.quoteblock>.title,
table.tableblock>.title,
.verseblock>.title,
.videoblock>.title,
.dlist>.title,
.olist>.title,
.ulist>.title,
.qlist>.title,
.hdlist>.title {
    line-height: 1.4;
    color: #222;
    font-weight: 300;
    margin-top: 0.2em;
    margin-bottom: 0.5em
}

div,
dl,
dt,
dd,
ul,
ol,
li,
h1,
h2,
h3,
#toctitle,
.sidebarblock>.content>.title,
h4,
h5,
h6,
pre,
form,
p,
blockquote,
th,
td {
    margin: 0;
    padding: 0;
    direction: ltr;
}

div.title {
    font-weight: bold !important;
}

a {
    color: #2980b9;
    text-decoration: none;
    line-height: inherit
}

a:hover,
a:focus {
    color: #3091d1
}

a img {
    border: none
}

p {
    font-family: inherit;
    font-weight: normal;
    font-size: 1em;
    line-height: 1.5;
    margin-bottom: 1.25em;
    text-rendering: optimizeLegibility
}

p aside {
    font-size: 0.875em;
    line-height: 1.35;
    font-style: italic
}

h1,
h2,
h3,
#toctitle,
.sidebarblock>.content>.title,
h4,
h5,
h6 {
    font-family: "Roboto", sans-serif;
    font-weight: bold;
    font-style: normal;
    color: #465158;
    text-rendering: optimizeLegibility;
    margin-top: 1em;
    margin-bottom: 0.5em;
    line-height: 1.2125em
}

h1 small,
h2 small,
h3 small,
#toctitle small,
.sidebarblock>.content>.title small,
h4 small,
h5 small,
h6 small {
    font-size: 60%;
    color: #909ea7;
    line-height: 0
}

h1 {
    font-size: 2.125em
}

h2 {
    font-size: 1.6875em
}

h3,
#toctitle,
.sidebarblock>.content>.title {
    font-size: 1.375em
}

h4 {
    font-size: 1.125em
}

h5 {
    font-size: 1.125em
}

h6 {
    font-size: 1em
}

hr {
    border: solid #ddd;
    border-width: 1px 0 0;
    clear: both;
    margin: 1.25em 0 1.1875em;
    height: 0
}

em,
i {
    font-style: italic;
    line-height: inherit
}

strong,
b {
    font-weight: bold;
    line-height: inherit
}

small {
    font-size: 60%;
    line-height: inherit
}

code {
    font-family: "Inconsolata", "Consolas", "Deja Vu Sans Mono", "Bitstream Vera Sans Mono", monospace;
    font-weight: normal;
    color: #2980b9
}

ul,
ol,
dl {
    font-size: 1em;
    line-height: 1.5;
    margin-bottom: 1.25em;
    list-style-position: outside;
    font-family: inherit
}

ul,
ol {
    margin-left: 0
}

ul.no-bullet,
ol.no-bullet {
    margin-left: 0
}

ul li ul,
ul li ol {
    margin-left: 1.25em;
    margin-bottom: 0;
    font-size: 1em
}

ul.square li ul,
ul.circle li ul,
ul.disc li ul {
    list-style: inherit
}

ul.square {
    list-style-type: square
}

ul.circle {
    list-style-type: circle
}

ul.disc {
    list-style-type: disc
}

ul.no-bullet {
    list-style: none
}

ol li ul,
ol li ol {
    margin-left: 1.25em;
    margin-bottom: 0
}

dl dt {
    margin-bottom: 0.3em;
    font-weight: bold
}

dl dd {
    margin-bottom: 0.75em
}

abbr,
acronym {
    text-transform: uppercase;
    font-size: 90%;
    color: #000;
    border-bottom: 1px dotted #ddd;
    cursor: help
}

abbr {
    text-transform: none
}

blockquote {
    margin: 0 0 1.25em;
    padding: 0.5625em 1.25em 0 1.1875em;
    border-left: 1px solid #ddd
}

blockquote cite {
    display: block;
    font-size: 0.8125em;
    color: #748590
}

blockquote cite:before {
    content: "\2014 \0020"
}

blockquote cite a,
blockquote cite a:visited {
    color: #748590
}

blockquote,
blockquote p {
    line-height: 1.5;
    color: #909ea7
}

.vcard {
    display: inline-block;
    margin: 0 0 1.25em 0;
    border: 1px solid #ddd;
    padding: 0.625em 0.75em
}

.vcard li {
    margin: 0;
    display: block
}

.vcard .fn {
    font-weight: bold;
    font-size: 0.9375em
}

.vevent .summary {
    font-weight: bold
}

.vevent abbr {
    cursor: auto;
    text-decoration: none;
    font-weight: bold;
    border: none;
    padding: 0 0.0625em
}

@media only screen and (min-width: 768px) {

    h1,
    h2,
    h3,
    #toctitle,
    .sidebarblock>.content>.title,
    h4,
    h5,
    h6 {
        line-height: 1.4
    }

    h1 {
        font-size: 2.75em
    }

    h2 {
        font-size: 2.3125em
    }

    h3,
    #toctitle,
    .sidebarblock>.content>.title {
        font-size: 1.6875em
    }

    h4 {
        font-size: 1.4375em
    }
}

table {
    background: #fff;
    margin-bottom: 1.25em;
    border: solid 0 #ddd
}

table thead,
table tfoot {
    background: none;
    font-weight: bold
}

table thead tr th,
table thead tr td,
table tfoot tr th,
table tfoot tr td {
    padding: 1px 8px 1px 5px;
    font-size: 1em;
    color: #222;
    text-align: left
}

table tr th,
table tr td {
    padding: 1px 8px 1px 5px;
    font-size: 1em;
    color: #222
}

table tr.even,
table tr.alt,
table tr:nth-of-type(even) {
    background: none
}

table thead tr th,
table tfoot tr th,
table tbody tr td,
table tr td,
table tfoot tr td {
    display: table-cell;
    line-height: 1.5
}

body {
    tab-size: 4;
    word-wrap: anywhere;
    font-family: "Lato", "Roboto", "Arial", "Helvetica Neue", sans-serif;
    -moz-osx-font-smoothing: grayscale;
    -webkit-font-smoothing: antialiased
}

table {
    word-wrap: normal
}

h1,
h2,
h3,
#toctitle,
.sidebarblock>.content>.title,
h4,
h5,
h6 {
    line-height: 1.4;
    padding-top: 75px;
    margin-top: -75px;
}

/* Fix the example block css */
.exampleblock>.content>h1,
.exampleblock>.content>h2,
.exampleblock>.content>h3,
.exampleblock>.content>h4,
.exampleblock>.content>h5,
.exampleblock>.content>h6 {
    line-height: 1.4;
    padding-top: unset;
    margin-top: unset;
}

object,
svg {
    display: inline-block;
    vertical-align: middle
}

.center {
    margin-left: auto;
    margin-right: auto
}

.stretch {
    width: 100%
}

.clearfix:before,
.clearfix:after,
.float-group:before,
.float-group:after {
    content: " ";
    display: table
}

.clearfix:after,
.float-group:after {
    clear: both
}

:not(pre).nobreak {
    word-wrap: normal
}

:not(pre).nowrap {
    white-space: nowrap
}

:not(pre).pre-wrap {
    white-space: pre-wrap
}

:not(pre):not([class^=L])>code {
    font-size: 0.95em;
    font-style: normal !important;
    letter-spacing: 0;
    padding: 0;
    background-color: #f2f2f2;
    -webkit-border-radius: 6px;
    border-radius: 6px;
    line-height: inherit
}

pre {
    color: inherit;
    font-family: "Consolas", "Deja Vu Sans Mono", "Bitstream Vera Sans Mono", monospace;
    line-height: 1.2
}

pre code,
pre pre {
    color: inherit;
    font-size: inherit;
    line-height: inherit
}

pre>code {
    display: block;
    padding-right: 25px;
}

pre.nowrap,
pre.nowrap pre {
    white-space: pre;
    word-wrap: normal
}

em em {
    font-style: normal
}

strong strong {
    font-weight: normal
}

.keyseq {
    color: #333
}

kbd {
    font-family: "Inconsolata", "Consolas", "Deja Vu Sans Mono", "Bitstream Vera Sans Mono", monospace;
    display: inline-block;
    color: #000;
    font-size: 0.65em;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 1px solid #ccc;
    -webkit-border-radius: 3px;
    border-radius: 3px;
    -webkit-box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em #fff inset;
    box-shadow: 0 1px 0 rgba(0, 0, 0, 0.2), 0 0 0 0.1em #fff inset;
    margin: 0 0.15em;
    padding: 0.2em 0.5em;
    vertical-align: middle;
    position: relative;
    top: -0.1em;
    white-space: nowrap
}

.keyseq kbd:first-child {
    margin-left: 0
}

.keyseq kbd:last-child {
    margin-right: 0
}

.menuseq,
.menuref {
    color: #000
}

.menuseq b:not(.caret),
.menuref {
    font-weight: inherit
}

.menuseq {
    word-spacing: -0.02em
}

.menuseq b.caret {
    font-size: 1.25em;
    line-height: 0.8
}

.menuseq i.caret {
    font-weight: bold;
    text-align: center;
    width: 0.45em
}

b.button:before,
b.button:after {
    position: relative;
    top: -1px;
    font-weight: normal
}

b.button:before {
    content: "[";
    padding: 0 3px 0 2px
}

b.button:after {
    content: "]";
    padding: 0 2px 0 3px
}

#header,
#content,
#footnotes,
#footer {
    width: 100%;
    margin-left: auto;
    margin-right: auto;
    margin-top: 0;
    margin-bottom: 0;
    max-width: 62.5em;
    *zoom: 1;
    position: relative;
    padding-left: 0.9375em;
    padding-right: 0.9375em
}

#header:before,
#header:after,
#content:before,
#content:after,
#footnotes:before,
#footnotes:after,
#footer:before,
#footer:after {
    content: " ";
    display: table
}

/*#footer:before {
    vertical-align: center;
    content: url(images/redhat_standard.svg);
    width: 140px;
    font-size: 200%;
    display: flex;
    flex-direction: column;
}*/


#header:after,
#content:after,
#footnotes:after,
#footer:after {
    clear: both
}

#content {
    margin-top: 1.25em
}

#content:before {
    content: none
}

#header>h1:first-child {
    color: #111;
    margin-top: 0.1rem;
    margin-bottom: 0
}

#header>h1:first-child+#toc {
    margin-top: 8px;
    border-top: 1px solid #ddd
}

#header>h1:only-child,
body.toc2 #header>h1:nth-last-child(2) {
    border-bottom: 1px solid #ddd;
    padding-bottom: 8px
}

#header .details {
    border-bottom: 1px solid #ddd;
    line-height: 1.45;
    padding-top: 0.25em;
    padding-bottom: 0.25em;
    padding-left: 0.25em;
    color: #748590;
    display: -ms-flexbox;
    display: -webkit-flex;
    display: flex;
    -ms-flex-flow: row wrap;
    -webkit-flex-flow: row wrap;
    flex-flow: row wrap
}

#header .details span:first-child {
    margin-left: -0.125em
}

#header .details span.email a {
    color: #909ea7
}

#header .details br {
    display: none
}

#header .details br+span:before {
    content: "\00a0\2013\00a0"
}

#header .details br+span.author:before {
    content: "\00a0\22c5\00a0";
    color: #909ea7
}

#header .details br+span#revremark:before {
    content: "\00a0|\00a0"
}

#header #revnumber {
    text-transform: capitalize
}

#header #revnumber:after {
    content: "\00a0"
}

#content>h1:first-child:not([class]) {
    color: #111;
    border-bottom: 1px solid #ddd;
    padding-bottom: 8px;
    margin-top: 0;
    padding-top: 1rem;
    margin-bottom: 1.25rem
}

#toc {
    border-bottom: 1px solid #ddd;
    padding-bottom: 0.5em
}

#toc>ul {
    margin-left: 0.125em
}

#toc ul.sectlevel0>li>a {
    font-style: italic
}

#toc ul.sectlevel0 ul.sectlevel1 {
    margin: 0.5em 0
}

#toc ul {
    font-family: "Roboto", sans-serif;
    list-style-type: none
}

#toc li {
    line-height: 1.3334;
    margin-top: 0.01em
}

#toc a {
    text-decoration: none
}

#toc a:active {
    text-decoration: underline
}

#toctitle {
    color: #6c818f;
    font-size: 1.2em
}

@media only screen and (min-width: 768px) {
    #toctitle {
        font-size: 1.375em
    }

    body.toc2 {
        padding-left: 15em;
        padding-right: 0
    }

    #toc.toc2 {
        margin-top: 0 !important;
        background: #f2f2f2;
        position: fixed;
        width: 15em;
        left: 0;
        top: 0;
        border-top-width: 0 !important;
        border-bottom-width: 0 !important;
        z-index: 1000;
        padding: 1.25em 1em;
        padding-left: 3px;
        height: 100%;
        overflow: auto;
        box-shadow: 0px 0px 5px 1px rgba(0, 0, 0, 0.41);
        -webkit-box-shadow: 0px 0px 5px 1px rgba(0, 0, 0, 0.41);
    }

    #toc.toc2 #toctitle {
        margin-top: 0;
        margin-bottom: 0.8rem;
        font-size: 1.2em;
    }

    #toc.toc2>ul {
        font-size: 0.9em;
        margin-bottom: 0
    }

    #toc.toc2 ul ul {
        margin-left: 0;
        padding-left: 1em
    }

    #toc.toc2 ul.sectlevel0 ul.sectlevel1 {
        padding-left: 0;
        margin-top: 0.5em;
        margin-bottom: 0.5em
    }

    body.toc2.toc-right {
        padding-left: 0;
        padding-right: 15em
    }

    body.toc2.toc-right #toc.toc2 {
        border-right-width: 0;
        border-left: 1px solid #ddd;
        left: auto;
        right: 0
    }

    #header,
    #content,
    #footnotes,
    #footer {
        max-width: 800px;
    }

}

@media only screen and (min-width: 1280px) {
    body.toc2 {
        padding-left: 10em;
        padding-right: 0
    }

    #toc.toc2 {
        width: 20em;
    }

    #toc.toc2 #toctitle {
        font-size: 1.375em
    }

    #toc.toc2>ul {
        font-size: 0.95em
    }

    #toc.toc2 ul ul {
        padding-left: 1.25em
    }

    body.toc2.toc-right {
        padding-left: 0;
        padding-right: 20em
    }
}

#content #toc {
    border-style: solid;
    border-width: 1px;
    border-color: #d9d9d9;
    margin-bottom: 1.25em;
    padding: 1.25em;
    background: #f2f2f2;
    -webkit-border-radius: 6px;
    border-radius: 6px
}

#content #toc>:first-child {
    margin-top: 0
}

#content #toc>:last-child {
    margin-bottom: 0
}

#footer {
    background-color: #fff;
    border-top: 5px;
    padding: 1.25em
}

#footer-text {
    color: #000;
    line-height: 1.35
}

#content {
    margin-bottom: 0.625em
}

.sect1 {
    padding-bottom: 0.625em
}

@media only screen and (min-width: 768px) {
    #content {
        margin-bottom: 1.25em
    }

    .sect1 {
        padding-bottom: 1.25em
    }
}

.sect1:last-child {
    padding-bottom: 0
}

.sect1+.sect1 {
    border-top: 1px solid #ddd
}

details,
.audioblock,
.imageblock,
.literalblock,
.listingblock,
.stemblock,
.videoblock {
    margin-bottom: 1.25em
}

details>summary:first-of-type {
    cursor: pointer;
    display: list-item;
    outline: none;
    margin-bottom: 0.75em
}

.admonitionblock td.content>.title,
.audioblock>.title,
.exampleblock>.title,
.imageblock>.title,
.listingblock>.title,
.literalblock>.title,
.stemblock>.title,
.openblock>.title,
.paragraph>.title,
.quoteblock>.title,
table.tableblock>.title,
.verseblock>.title,
.videoblock>.title,
.dlist>.title,
.olist>.title,
.ulist>.title,
.qlist>.title,
.hdlist>.title {
    text-rendering: optimizeLegibility;
    text-align: left
}

table.tableblock.fit-content>caption.title {
    white-space: nowrap;
    width: 0
}

.paragraph.lead>p,
#preamble>.sectionbody>[class="paragraph"]:first-of-type p {
    font-size: 1.21875em;
    line-height: 1.6;
    color: #111
}

table.tableblock #preamble>.sectionbody>[class="paragraph"]:first-of-type p {
    font-size: inherit
}

.admonitionblock>table {
    border-collapse: separate;
    border: 0;
    background: none;
    width: 100%
}

.admonitionblock>table td.icon {
    text-align: center;
    width: 80px
}

.admonitionblock>table td.icon img {
    max-width: none
}

.admonitionblock>table td.icon .title {
    font-weight: bold;
    font-family: "Roboto", sans-serif;
    text-transform: uppercase
}

.admonitionblock>table td.content {
    padding-left: 1.125em;
    padding-right: 1.25em;
    border-left: 1px solid #ddd;
    color: #748590;
    word-wrap: anywhere
}

.admonitionblock>table td.content>:last-child>:last-child {
    margin-bottom: 0
}

.exampleblock>.content {
    border-style: solid;
    border-width: 1px;
    border-color: #e6e6e6;
    margin-bottom: 1.25em;
    padding: 1.25em;
    background: #fff;
    -webkit-border-radius: 6px;
    border-radius: 6px
}

.exampleblock>.content>:first-child {
    margin-top: 0
}

.exampleblock>.content>:last-child {
    margin-bottom: 0
}

.sidebarblock {
    border-style: solid;
    border-width: 1px;
    border-color: #d4d4d4;
    margin-bottom: 1.25em;
    padding: 1.25em;
    background: #ededed;
    -webkit-border-radius: 6px;
    border-radius: 6px
}

.sidebarblock>:first-child {
    margin-top: 0
}

.sidebarblock>:last-child {
    margin-bottom: 0
}

.sidebarblock>.content>.title {
    color: #000;
    margin-top: 0
}

.exampleblock>.content>:last-child>:last-child,
.exampleblock>.content .olist>ol>li:last-child>:last-child,
.exampleblock>.content .ulist>ul>li:last-child>:last-child,
.exampleblock>.content .qlist>ol>li:last-child>:last-child,
.sidebarblock>.content>:last-child>:last-child,
.sidebarblock>.content .olist>ol>li:last-child>:last-child,
.sidebarblock>.content .ulist>ul>li:last-child>:last-child,
.sidebarblock>.content .qlist>ol>li:last-child>:last-child {
    margin-bottom: 0
}

.literalblock pre,
.listingblock>.content>pre {
    border: 1px solid #ccc;
    -webkit-border-radius: 6px;
    border-radius: 6px;
    overflow-x: auto;
    padding: 0.5em;
    font-size: 0.8125em
}

@media only screen and (min-width: 768px) {

    .literalblock pre,
    .listingblock>.content>pre {
        font-size: 0.90625em
    }
}

@media only screen and (min-width: 1280px) {

    .literalblock pre,
    .listingblock>.content>pre {
        font-size: 0.90625em
    }
}

.literalblock pre,
.listingblock>.content>pre:not(.highlight),
.listingblock>.content>pre[class="highlight"],
.listingblock>.content>pre[class^="highlight "] {
    background: #eee
}

.literalblock.output pre {
    color: #eee;
    background-color: inherit
}

.listingblock>.content {
    position: relative
}

.listingblock code[data-lang]:before {
    display: none;
    content: attr(data-lang);
    position: absolute;
    font-size: 0.75em;
    bottom: 0.425rem;
    right: 0.5rem;
    text-transform: uppercase;
    color: inherit;
    opacity: 0.5
}

.listingblock:hover code[data-lang]:before {
    display: block
}

.listingblock.terminal pre .command:before {
    content: attr(data-prompt);
    padding-right: 0.5em;
    color: inherit;
    opacity: 0.5
}

.listingblock.terminal pre .command:not([data-prompt]):before {
    content: "$"
}

.listingblock pre.highlightjs {
    padding: 0
}

.listingblock pre.highlightjs>code {
    -webkit-border-radius: 2px;
    border-radius: 2px;
    padding: 21px;
}

.prettyprint {
    background: #eee
}

pre.prettyprint .linenums {
    line-height: 1.2;
    margin-left: 2em
}

pre.prettyprint li {
    background: none;
    list-style-type: inherit;
    padding-left: 0
}

pre.prettyprint li code[data-lang]:before {
    opacity: 1
}

pre.prettyprint li:not(:first-child) code[data-lang]:before {
    display: none
}

table.linenotable {
    border-collapse: separate;
    border: 0;
    margin-bottom: 0;
    background: none
}

table.linenotable td[class] {
    color: inherit;
    vertical-align: top;
    padding: 0;
    line-height: inherit;
    white-space: normal
}

table.linenotable td.code {
    padding-left: 0.75em
}

table.linenotable td.linenos {
    border-right: 1px solid currentColor;
    opacity: 0.35;
    padding-right: 0.5em
}

pre.pygments .lineno {
    border-right: 1px solid currentColor;
    opacity: 0.35;
    display: inline-block;
    margin-right: 0.75em
}

pre.pygments .lineno:before {
    content: "";
    margin-right: -0.125em
}

.quoteblock {
    margin: 0 1em 1.25em 1.5em;
    display: table
}

.quoteblock:not(.excerpt)>.title {
    margin-left: -1.5em;
    margin-bottom: 0.75em
}

.quoteblock blockquote,
.quoteblock p {
    color: #909ea7;
    font-size: 1.15rem;
    line-height: 1.75;
    word-spacing: 0.1em;
    letter-spacing: 0;
    font-style: italic;
    text-align: justify
}

.quoteblock blockquote {
    margin: 0;
    padding: 0;
    border: 0
}

.quoteblock blockquote:before {
    content: "\201c";
    float: left;
    font-size: 2.75em;
    font-weight: bold;
    line-height: 0.6em;
    margin-left: -0.6em;
    color: #6c818f;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.1)
}

.quoteblock blockquote>.paragraph:last-child p {
    margin-bottom: 0
}

.quoteblock .attribution {
    margin-top: 0.75em;
    margin-right: 0.5ex;
    text-align: right
}

.verseblock {
    margin: 0 1em 1.25em 1em
}

.verseblock pre {
    font-family: "Open Sans", "DejaVu Sans", sans;
    font-size: 1.15rem;
    color: #909ea7;
    font-weight: 300;
    text-rendering: optimizeLegibility
}

.verseblock pre strong {
    font-weight: 400
}

.verseblock .attribution {
    margin-top: 1.25rem;
    margin-left: 0.5ex
}

.quoteblock .attribution,
.verseblock .attribution {
    font-size: 0.8125em;
    line-height: 1.45;
    font-style: italic
}

.quoteblock .attribution br,
.verseblock .attribution br {
    display: none
}

.quoteblock .attribution cite,
.verseblock .attribution cite {
    display: block;
    letter-spacing: -0.025em;
    color: #748590
}

.quoteblock.abstract blockquote:before,
.quoteblock.excerpt blockquote:before,
.quoteblock .quoteblock blockquote:before {
    display: none
}

.quoteblock.abstract blockquote,
.quoteblock.abstract p,
.quoteblock.excerpt blockquote,
.quoteblock.excerpt p,
.quoteblock .quoteblock blockquote,
.quoteblock .quoteblock p {
    line-height: 1.6;
    word-spacing: 0
}

.quoteblock.abstract {
    margin: 0 1em 1.25em 1em;
    display: block
}

.quoteblock.abstract>.title {
    margin: 0 0 0.375em 0;
    font-size: 1.15em;
    text-align: center
}

.quoteblock.excerpt>blockquote,
.quoteblock .quoteblock {
    padding: 0 0 0.25em 1em;
    border-left: 0.25em solid #ddd
}

.quoteblock.excerpt,
.quoteblock .quoteblock {
    margin-left: 0
}

.quoteblock.excerpt blockquote,
.quoteblock.excerpt p,
.quoteblock .quoteblock blockquote,
.quoteblock .quoteblock p {
    color: inherit;
    font-size: 1.0625rem
}

.quoteblock.excerpt .attribution,
.quoteblock .quoteblock .attribution {
    color: inherit;
    text-align: left;
    margin-right: 0
}

p.tableblock:last-child {
    margin-bottom: 0
}

td.tableblock>.content {
    margin-bottom: 1.25em;
    word-wrap: anywhere
}

td.tableblock>.content>:last-child {
    margin-bottom: -1.25em
}

table.tableblock,
th.tableblock,
td.tableblock {
    border: 0 solid #ddd
}

table.grid-all>*>tr>* {
    border-width: 0
}

table.grid-cols>*>tr>* {
    border-width: 0 0
}

table.grid-rows>*>tr>* {
    border-width: 0 0
}

table.frame-all {
    border-width: 0
}

table.frame-ends {
    border-width: 0 0
}

table.frame-sides {
    border-width: 0 0
}

table.frame-none>colgroup+*>:first-child>*,
table.frame-sides>colgroup+*>:first-child>* {
    border-top-width: 0
}

table.frame-none>:last-child>:last-child>*,
table.frame-sides>:last-child>:last-child>* {
    border-bottom-width: 0
}

table.frame-none>*>tr>:first-child,
table.frame-ends>*>tr>:first-child {
    border-left-width: 0
}

table.frame-none>*>tr>:last-child,
table.frame-ends>*>tr>:last-child {
    border-right-width: 0
}

table.stripes-all tr,
table.stripes-odd tr:nth-of-type(odd),
table.stripes-even tr:nth-of-type(even),
table.stripes-hover tr:hover {
    background: none
}

th.halign-left,
td.halign-left {
    text-align: left
}

th.halign-right,
td.halign-right {
    text-align: right
}

th.halign-center,
td.halign-center {
    text-align: center
}

th.valign-top,
td.valign-top {
    vertical-align: top
}

th.valign-bottom,
td.valign-bottom {
    vertical-align: bottom
}

th.valign-middle,
td.valign-middle {
    vertical-align: middle
}

table thead th,
table tfoot th {
    font-weight: bold
}

tbody tr th {
    display: table-cell;
    line-height: 1.5;
    background: none
}

tbody tr th,
tbody tr th p,
tfoot tr th,
tfoot tr th p {
    color: #222;
    font-weight: bold
}

p.tableblock {
    font-size: 1em
}

ol {
    margin-left: 0.25em
}

ul li ol {
    margin-left: 0
}

dl dd {
    margin-left: 1.125em
}

dl dd:last-child,
dl dd:last-child>:last-child {
    margin-bottom: 0
}

ol>li p,
ul>li p,
ul dd,
ol dd,
.olist .olist,
.ulist .ulist,
.ulist .olist,
.olist .ulist {
    margin-bottom: 0.625em
}

ul.checklist,
ul.none,
ol.none,
ul.no-bullet,
ol.no-bullet,
ol.unnumbered,
ul.unstyled,
ol.unstyled {
    list-style-type: none
}

ul.no-bullet,
ol.no-bullet,
ol.unnumbered {
    margin-left: 0.625em
}

ul.unstyled,
ol.unstyled {
    margin-left: 0
}

ul.checklist {
    margin-left: 0.625em
}

ul.checklist li>p:first-child>.fa-square-o:first-child,
ul.checklist li>p:first-child>.fa-check-square-o:first-child {
    width: 1.25em;
    font-size: 0.8em;
    position: relative;
    bottom: 0.125em
}

ul.checklist li>p:first-child>input[type="checkbox"]:first-child {
    margin-right: 0.25em
}

ul.inline {
    display: -ms-flexbox;
    display: -webkit-box;
    display: flex;
    -ms-flex-flow: row wrap;
    -webkit-flex-flow: row wrap;
    flex-flow: row wrap;
    list-style: none;
    margin: 0 0 0.625em -1.25em
}

ul.inline>li {
    margin-left: 1.25em
}

.unstyled dl dt {
    font-weight: normal;
    font-style: normal
}

ol.arabic {
    list-style-type: decimal
}

ol.decimal {
    list-style-type: decimal-leading-zero
}

ol.loweralpha {
    list-style-type: lower-alpha
}

ol.upperalpha {
    list-style-type: upper-alpha
}

ol.lowerroman {
    list-style-type: lower-roman
}

ol.upperroman {
    list-style-type: upper-roman
}

ol.lowergreek {
    list-style-type: lower-greek
}

.hdlist>table,
.colist>table {
    border: 0;
    background: none
}

.hdlist>table>tbody>tr,
.colist>table>tbody>tr {
    background: none
}

td.hdlist1,
td.hdlist2 {
    vertical-align: top;
    padding: 0 0.625em
}

td.hdlist1 {
    font-weight: bold;
    padding-bottom: 1.25em
}

td.hdlist2 {
    word-wrap: anywhere
}

.literalblock+.colist,
.listingblock+.colist {
    margin-top: -0.5em
}

.colist td:not([class]):first-child {
    padding: 0.4em 0.75em 0 0.75em;
    line-height: 1;
    vertical-align: top
}

.colist td:not([class]):first-child img {
    max-width: none
}

.colist td:not([class]):last-child {
    padding: 0.25em 0
}

.thumb,
.th {
    line-height: 0;
    display: inline-block;
    border: solid 4px #fff;
    -webkit-box-shadow: 0 0 0 1px #ddd;
    box-shadow: 0 0 0 1px #ddd
}

.imageblock.left {
    margin: 0.25em 0.625em 1.25em 0
}

.imageblock.right {
    margin: 0.25em 0 1.25em 0.625em
}

.imageblock>.title {
    margin-bottom: 0
}

.imageblock.thumb,
.imageblock.th {
    border-width: 6px
}

.imageblock.thumb>.title,
.imageblock.th>.title {
    padding: 0 0.125em
}

.image.left,
.image.right {
    margin-top: 0.25em;
    margin-bottom: 0.25em;
    display: inline-block;
    line-height: 0
}

.image.left {
    margin-right: 0.625em
}

.image.right {
    margin-left: 0.625em
}

a.image {
    text-decoration: none;
    display: inline-block
}

a.image object {
    pointer-events: none
}

sup.footnote,
sup.footnoteref {
    font-size: 0.875em;
    position: static;
    vertical-align: super
}

sup.footnote a,
sup.footnoteref a {
    text-decoration: none
}

sup.footnote a:active,
sup.footnoteref a:active {
    text-decoration: underline
}

#footnotes {
    padding-top: 0.75em;
    padding-bottom: 0.75em;
    margin-bottom: 0.625em
}

#footnotes hr {
    width: 20%;
    min-width: 6.25em;
    margin: -0.25em 0 0.75em 0;
    border-width: 1px 0 0 0
}

#footnotes .footnote {
    padding: 0 0.375em 0 0.225em;
    line-height: 1.3334;
    font-size: 0.875em;
    margin-left: 1.2em;
    margin-bottom: 0.2em
}

#footnotes .footnote a:first-of-type {
    font-weight: bold;
    text-decoration: none;
    margin-left: -1.05em
}

#footnotes .footnote:last-of-type {
    margin-bottom: 0
}

#content #footnotes {
    margin-top: -0.625em;
    margin-bottom: 0;
    padding: 0.75em 0
}

.gist .file-data>table {
    border: 0;
    background: #fff;
    width: 100%;
    margin-bottom: 0
}

.gist .file-data>table td.line-data {
    width: 99%
}

div.unbreakable {
    page-break-inside: avoid
}

.big {
    font-size: larger
}

.small {
    font-size: smaller
}

.underline {
    text-decoration: underline
}

.overline {
    text-decoration: overline
}

.line-through {
    text-decoration: line-through
}

.aqua {
    color: #00bfbf
}

.aqua-background {
    background-color: #00fafa
}

.black {
    color: #000
}

.black-background {
    background-color: #000
}

.blue {
    color: #0000bf
}

.blue-background {
    background-color: #0000fa
}

.fuchsia {
    color: #bf00bf
}

.fuchsia-background {
    background-color: #fa00fa
}

.gray {
    color: #606060
}

.gray-background {
    background-color: #7d7d7d
}

.green {
    color: #006000
}

.green-background {
    background-color: #007d00
}

.lime {
    color: #00bf00
}

.lime-background {
    background-color: #00fa00
}

.maroon {
    color: #600000
}

.maroon-background {
    background-color: #7d0000
}

.navy {
    color: #000060
}

.navy-background {
    background-color: #00007d
}

.olive {
    color: #606000
}

.olive-background {
    background-color: #7d7d00
}

.purple {
    color: #600060
}

.purple-background {
    background-color: #7d007d
}

.red {
    color: #bf0000
}

.red-background {
    background-color: #fa0000
}

.silver {
    color: #909090
}

.silver-background {
    background-color: #bcbcbc
}

.teal {
    color: #006060
}

.teal-background {
    background-color: #007d7d
}

.white {
    color: #bfbfbf
}

.white-background {
    background-color: #fafafa
}

.yellow {
    color: #bfbf00
}

.yellow-background {
    background-color: #fafa00
}

span.icon>.fa {
    cursor: default
}

a span.icon>.fa {
    cursor: inherit
}

.admonitionblock td.icon [class^="fa icon-"] {
    font-size: 2.5em;
    text-shadow: 1px 1px 1px rgba(0, 0, 0, 0.3);
    cursor: default
}

.admonitionblock td.icon .icon-note:before {
    content: "\f05a";
    color: white
}

.admonitionblock td.icon .icon-tip:before {
    content: "\f0eb";
    text-shadow: 1px 1px 2px rgba(155, 155, 0, 0.8);
    color: white
}

.admonitionblock td.icon .icon-warning:before {
    content: "\f071";
    color: white
}

.admonitionblock td.icon .icon-caution:before {
    content: "\f06d";
    color: white
}

.admonitionblock td.icon .icon-important:before {
    content: "\f06a";
    color: white
}

.conum[data-value] {
    display: inline-block;
    color: #fff !important;
    background-color: #000;
    -webkit-border-radius: 50%;
    border-radius: 50%;
    text-align: center;
    font-size: 0.75em;
    width: 1.67em;
    height: 1.67em;
    line-height: 1.67em;
    font-family: "Open Sans", "DejaVu Sans", sans-serif;
    font-style: normal;
    font-weight: bold
}

.conum[data-value] * {
    color: #fff !important
}

.conum[data-value]+b {
    display: none
}

.conum[data-value]:after {
    content: attr(data-value)
}

pre .conum[data-value] {
    position: relative;
    top: -0.125em
}

b.conum * {
    color: inherit !important
}

.conum:not([data-value]):empty {
    display: none
}

h4 {
    color: #6c818f
}

.literalblock>.content>pre,
.listingblock>.content>pre {
    -webkit-border-radius: 6px;
    border-radius: 6px;
    margin-left: 2em;
    margin-right: 2em
}

.admonitionblock {
    margin-left: 2em;
    margin-right: 2em
}

.admonitionblock>table {
    border: 1px solid #609060;
    border-top-width: 1.5em;
    background-color: #e9ffe9;
    border-collapse: separate;
    -webkit-border-radius: 0;
    border-radius: 0
}

.admonitionblock>table td.icon {
    padding-top: .5em;
    padding-bottom: .5em
}

.admonitionblock>table td.content {
    padding: .5em 1em;
    color: #000;
    font-size: .9em;
    border-left: none
}

.sidebarblock {
    background-color: #e8ecef;
    border-color: #ccc
}

.sidebarblock>.content>.title {
    color: #000
}

table.tableblock.grid-all {
    border-collapse: collapse;
    -webkit-border-radius: 0;
    border-radius: 0
}

table.tableblock.grid-all th.tableblock,
table.tableblock.grid-all td.tableblock {
    border-bottom: 1px solid #aaa
}

#footer {
    background-color: #fff;
    border-top: 2px solid #f3f3f3;
    padding: 1em
}

#footer-text {
    font-size: 0.8em;
    text-align: left;
    padding-top: 10px;
}

#toc.toc2 {
    font-family: "Lato", "Roboto", "Arial", "Helvetica Neue", sans-serif;
    padding: 0;
}

#toc.toc2 #toctitle {
    padding: 1em 1em;
    text-align: left;
    font-family: "Roboto", sans-serif;
    color: #465158;
    background: #f3f3f3;
    text-transform: uppercase;
    font-size: medium;
    border-bottom: 1px solid #dedede;
}

/*#toc.toc2 #toctitle::before {
    vertical-align: left;
    content: url(images/redhat_standard.svg);
    width: 140px;
    font-size: 200%;
    margin-left: 45px;
    display: flex;
    flex-direction: column;
}*/

#toc.toc2 a {
    display: block;
    color: #d9d9d9;
    padding: 0.25em 1em
}

#toc.toc2 a:hover,
#toc.toc2 a:focus {
    background: #dedede
}

#toc.toc2 ul {
    font-family: "Lato", "Roboto", "Arial", "Helvetica Neue", sans-serif
}

#toc.toc2 ul.sectlevel1 a {
    font-weight: bold;
    color: #465158
}

#toc.toc2 ul.sectlevel1 a {
    border-right: 3px solid transparent;
}
#toc.toc2 ul.sectlevel1 a:hover,
#toc.toc2 ul.sectlevel1 a:focus {
    color: #000;
    border-right: 3px solid #8b8b8b;
}

#toc.toc2 ul.sectlevel2,
#toc.toc2 ul.sectlevel3,
#toc.toc2 ul.sectlevel4,
#toc.toc2 ul.sectlevel5,
#toc.toc2 ul.sectlevel6 {
    padding: 0
}

#toc.toc2 ul.sectlevel2 a,
#toc.toc2 ul.sectlevel3 a,
#toc.toc2 ul.sectlevel4 a,
#toc.toc2 ul.sectlevel5 a,
#toc.toc2 ul.sectlevel6 a {
    font-weight: normal;
    color: #465158
}

#toc.toc2 ul.sectlevel2.sectlevel2 a,
#toc.toc2 ul.sectlevel3.sectlevel2 a,
#toc.toc2 ul.sectlevel4.sectlevel2 a,
#toc.toc2 ul.sectlevel5.sectlevel2 a,
#toc.toc2 ul.sectlevel6.sectlevel2 a {
    padding-left: 2em
}

#toc.toc2 ul.sectlevel2.sectlevel3 a,
#toc.toc2 ul.sectlevel3.sectlevel3 a,
#toc.toc2 ul.sectlevel4.sectlevel3 a,
#toc.toc2 ul.sectlevel5.sectlevel3 a,
#toc.toc2 ul.sectlevel6.sectlevel3 a {
    padding-left: 3em
}

#toc.toc2 ul.sectlevel2.sectlevel4 a,
#toc.toc2 ul.sectlevel3.sectlevel4 a,
#toc.toc2 ul.sectlevel4.sectlevel4 a,
#toc.toc2 ul.sectlevel5.sectlevel4 a,
#toc.toc2 ul.sectlevel6.sectlevel4 a {
    padding-left: 4em
}

#toc.toc2 ul.sectlevel2.sectlevel5 a,
#toc.toc2 ul.sectlevel3.sectlevel5 a,
#toc.toc2 ul.sectlevel4.sectlevel5 a,
#toc.toc2 ul.sectlevel5.sectlevel5 a,
#toc.toc2 ul.sectlevel6.sectlevel5 a {
    padding-left: 5em
}

#toc.toc2 ul.sectlevel2.sectlevel6 a,
#toc.toc2 ul.sectlevel3.sectlevel6 a,
#toc.toc2 ul.sectlevel4.sectlevel6 a,
#toc.toc2 ul.sectlevel5.sectlevel6 a,
#toc.toc2 ul.sectlevel6.sectlevel6 a {
    padding-left: 6em
}

:not(pre):not([class^="L"])>code {
    font-size: 0.95em;
    font-style: normal !important;
    letter-spacing: 0;
    padding: 0px 4px;
    background-color: #f6f6f6;
    -webkit-border-radius: 4px;
    border-radius: 4px;
    line-height: inherit;
    border: solid #ddd7d7 1px;
    color: #465158;
}

.admonitionblock {
    margin: 0
}

.admonitionblock.note>table {
    background-color: #e7f2fa
}

.admonitionblock.note>table td.icon {
    background-color: #3e97d7;
    width: 100%;
    text-align: left;
    padding-left: 2em
}

.admonitionblock.note>table td.icon i.icon-note::before {
    color: white
}

.admonitionblock.note>table td.icon i.icon-note::after {
    color: white;
    content: "Note";
    padding-left: 1em;
    font-family: "Lato", "Roboto", "Arial", "Helvetica Neue", sans-serif;
    font-size: 0.9em;
    font-weight: bold
}

.admonitionblock.tip>table {
    background-color: #e9ffe9
}

.admonitionblock.tip>table td.icon {
    background-color: #00b600;
    width: 100%;
    text-align: left;
    padding-left: 2em
}

.admonitionblock.tip>table td.icon i.icon-tip::before {
    color: white
}

.admonitionblock.tip>table td.icon i.icon-tip::after {
    color: white;
    content: "Tip";
    padding-left: 1em;
    font-family: "Lato", "Roboto", "Arial", "Helvetica Neue", sans-serif;
    font-size: 0.9em;
    font-weight: bold
}

.admonitionblock.caution>table {
    background-color: #ffe3ca
}

.admonitionblock.caution>table td.icon {
    background-color: #fd7700;
    width: 100%;
    text-align: left;
    padding-left: 2em
}

.admonitionblock.caution>table td.icon i.icon-caution::before {
    color: white
}

.admonitionblock.caution>table td.icon i.icon-caution::after {
    color: white;
    content: "Caution";
    padding-left: 1em;
    font-family: "Lato", "Roboto", "Arial", "Helvetica Neue", sans-serif;
    font-size: 0.9em;
    font-weight: bold
}

.admonitionblock.warning>table {
    background-color: #ffd6ca
}

.admonitionblock.warning>table td.icon {
    background-color: #fd3900;
    width: 100%;
    text-align: left;
    padding-left: 2em
}

.admonitionblock.warning>table td.icon i.icon-warning::before {
    color: white
}

.admonitionblock.warning>table td.icon i.icon-warning::after {
    color: white;
    content: "Warning";
    padding-left: 1em;
    font-family: "Lato", "Roboto", "Arial", "Helvetica Neue", sans-serif;
    font-size: 0.9em;
    font-weight: bold
}

.admonitionblock.important>table {
    background-color: #ffedcc
}

.admonitionblock.important>table td.icon {
    background-color: orange;
    width: 100%;
    text-align: left;
    padding-left: 2em
}

.admonitionblock.important>table td.icon i.icon-important::before {
    color: white
}

.admonitionblock.important>table td.icon i.icon-important::after {
    color: white;
    content: "Important";
    padding-left: 1em;
    font-family: "Lato", "Roboto", "Arial", "Helvetica Neue", sans-serif;
    font-size: 0.9em;
    font-weight: bold
}

.admonitionblock>table {
    border: none
}

.admonitionblock>table td {
    display: inline-block;
    width: 100%;
    font-size: 8px
}

.tableblock code {
    border: none;
}

.literalblock>.content>pre,
.listingblock>.content>pre {
    margin: 0
}

.literalblock pre,
.listingblock>.content>pre {
    background: #f8f8f8;
    padding: 15px;
}

@media only screen and (min-width: 768px) {
    #toc.toc2 {
        padding: 0;
        background: #f3f3f3;
    }

    /*#toc.toc2 #toctitle::before {
        margin-left: -0.5em
    }*/
}

.ulist:not(.checklist) ul,
.ulist:not(.checklist) ol {
    margin-left: 1.5em
}

/*.ulist:not(.checklist) ul li>p,
.ulist:not(.checklist) ol li>p {
    padding-left: 0.5em
}*/

.olist ol {
    margin-left: 2em
}

i.conum[data-value] {
    background-color: #465158
}

#content h1:hover>a.anchor,
#content h1>a.anchor:hover,
h2:hover>a.anchor,
h2>a.anchor:hover,
h3:hover>a.anchor,
#toctitle:hover>a.anchor,
.sidebarblock>.content>.title:hover>a.anchor,
h3>a.anchor:hover,
#toctitle>a.anchor:hover,
.sidebarblock>.content>.title>a.anchor:hover,
h4:hover>a.anchor,
h4>a.anchor:hover,
h5:hover>a.anchor,
h5>a.anchor:hover,
h6:hover>a.anchor,
h6>a.anchor:hover {
    visibility: visible
}

#content h1>a.link,
h2>a.link,
h3>a.link,
#toctitle>a.link,
.sidebarblock>.content>.title>a.link,
h4>a.link,
h5>a.link,
h6>a.link {
    color: #465158;
    text-decoration: none
}

#content h1>a.link:hover,
h2>a.link:hover,
h3>a.link:hover,
#toctitle>a.link:hover,
.sidebarblock>.content>.title>a.link:hover,
h4>a.link:hover,
h5>a.link:hover,
h6>a.link:hover {
    color: #3b444a
}

#content h1>a.link:hover:after,
h2>a.link:hover:after,
h3>a.link:hover:after,
#toctitle>a.link:hover:after,
.sidebarblock>.content>.title>a.link:hover:after,
h4>a.link:hover:after,
h5>a.link:hover:after,
h6>a.link:hover:after {
    content: "\f0c1";
    font-family: 'FontAwesome';
    font-size: 0.65em;
    display: inline-block;
    color: #3091d1;
    margin-left: 0.5em
}

/* Top navigation */
.navbar {
    background-color: #333;
    overflow: hidden;
    padding: 1em;
    position: fixed;
    width: 100%;
    top: 0;
    color: #fff !important;
    font-weight: bold;
    text-transform: uppercase;
    height: 60px;
    z-index: 9999999;
    left: 0;
    filter: drop-shadow(-3px -13px 23px #000);
    transform: translateY(-100px);
    transition: 0.4s;
}

.navbar a {
    color: #fff !important;
}

.show {
    transform: translateY(0);
}

/* Copy code */
div.content>pre>button {
    display: none;
}*

div.listingblock>div>pre.rouge>button {
    display: unset;
    border: 0;
    font-size: 0.6em;
    padding: 5px;
    text-transform: uppercase;
    font-weight: 400;
    position: absolute;
    top: 0.425rem;
    right: 0.5rem;
    background: #dedede;
    color: inherit;
    opacity: 0.5;
    border-radius: 4px;
}

/* GitHub link */
.github-corner:hover .octo-arm {
    animation: octocat-wave 560ms ease-in-out
}

@keyframes octocat-wave {
    0%,
    100% {
        transform: rotate(0)
    }

    20%,
    60% {
        transform: rotate(-25deg)
    }

    40%,
    80% {
        transform: rotate(10deg)
    }
}

/* Active TOC item tweak */
.active {
    border-right: 3px solid #2e2e2e !important;
    font-weight: bold;
    color: #465158;
    background: #dedede;
    text-decoration: none;
}

@media only screen and (max-width: 767px) {
    #toc.toc2 {
        padding: 0;
        background: #f3f3f3;
    }

    #toc.toc2 #toctitle::before {
        display: none;
    }

    #toc.toc2 #toctitle {
        display: none;
    }

    /* Top navigation */
    .navbar {
        height: 4.3em;
        font-size: 0.9em;
    }

}

@media (max-width:500px) {
    .github-corner:hover .octo-arm {
        animation: none
    }

    .github-corner .octo-arm {
        animation: octocat-wave 560ms ease-in-out
    }
}



</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<style>
pre.rouge table td { padding: 5px; }
pre.rouge table pre { margin: 0; }
pre.rouge, pre.rouge .w {
  color: #24292f;
  background-color: #f6f8fa;
}
pre.rouge .k, pre.rouge .kd, pre.rouge .kn, pre.rouge .kp, pre.rouge .kr, pre.rouge .kt, pre.rouge .kv {
  color: #cf222e;
}
pre.rouge .gr {
  color: #f6f8fa;
}
pre.rouge .gd {
  color: #82071e;
  background-color: #ffebe9;
}
pre.rouge .nb {
  color: #953800;
}
pre.rouge .nc {
  color: #953800;
}
pre.rouge .no {
  color: #953800;
}
pre.rouge .nn {
  color: #953800;
}
pre.rouge .sr {
  color: #116329;
}
pre.rouge .na {
  color: #116329;
}
pre.rouge .nt {
  color: #116329;
}
pre.rouge .gi {
  color: #116329;
  background-color: #dafbe1;
}
pre.rouge .kc {
  color: #0550ae;
}
pre.rouge .l, pre.rouge .ld, pre.rouge .m, pre.rouge .mb, pre.rouge .mf, pre.rouge .mh, pre.rouge .mi, pre.rouge .il, pre.rouge .mo, pre.rouge .mx {
  color: #0550ae;
}
pre.rouge .sb {
  color: #0550ae;
}
pre.rouge .bp {
  color: #0550ae;
}
pre.rouge .ne {
  color: #0550ae;
}
pre.rouge .nl {
  color: #0550ae;
}
pre.rouge .py {
  color: #0550ae;
}
pre.rouge .nv, pre.rouge .vc, pre.rouge .vg, pre.rouge .vi, pre.rouge .vm {
  color: #0550ae;
}
pre.rouge .o, pre.rouge .ow {
  color: #0550ae;
}
pre.rouge .gh {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .gu {
  color: #0550ae;
  font-weight: bold;
}
pre.rouge .s, pre.rouge .sa, pre.rouge .sc, pre.rouge .dl, pre.rouge .sd, pre.rouge .s2, pre.rouge .se, pre.rouge .sh, pre.rouge .sx, pre.rouge .s1, pre.rouge .ss {
  color: #0a3069;
}
pre.rouge .nd {
  color: #8250df;
}
pre.rouge .nf, pre.rouge .fm {
  color: #8250df;
}
pre.rouge .err {
  color: #f6f8fa;
  background-color: #82071e;
}
pre.rouge .c, pre.rouge .ch, pre.rouge .cd, pre.rouge .cm, pre.rouge .cp, pre.rouge .cpf, pre.rouge .c1, pre.rouge .cs {
  color: #6e7781;
}
pre.rouge .gl {
  color: #6e7781;
}
pre.rouge .gt {
  color: #6e7781;
}
pre.rouge .ni {
  color: #24292f;
}
pre.rouge .si {
  color: #24292f;
}
pre.rouge .ge {
  color: #24292f;
  font-style: italic;
}
pre.rouge .gs {
  color: #24292f;
  font-weight: bold;
}
</style>
<meta name="viewport" content="width=device-width, height=device-height, initial-scale=1.0, maximum-scale=1.0" />
<script src="./assets/js/jquery.min.js"></script>
</head>
<body id="cnf-best-practices" class="article toc2 toc-left">
<!-- Navbar -->
<div class="paragraph navbar">
    <p><a href="#"><span class="image"><img src="assets/img/logo.svg" alt="Home" width="30"></span> | CNF Best Practices for Far Edge Applications</a>
    </p>
</div>
<div id="header">
<h1>CNF Best Practices for Far Edge Applications</h1>
<div class="details">
<span id="author" class="author">Cloud-native network functions best practices for Far Edge applications</span><br>
<span id="revnumber">version 1.5,</span>
<span id="revdate">2023</span>
</div>
<div id="toc" class="toc2">
<div id="toctitle">Table of Contents</div>
<ul class="sectlevel1">
<li><a href="#cnf-best-practices-far-edge-introduction">1. Refactoring software as cloud-native network functions</a>
<ul class="sectlevel2">
<li><a href="#cnf-best-practices-pods">1.1. Pods</a></li>
</ul>
</li>
<li><a href="#cnf-best-practices-expectations-and-permissions">2. CNF expectations and permissions</a>
<ul class="sectlevel2">
<li><a href="#cnf-best-practices-high-level-cnf-expectations">2.1. High-level CNF expectations</a></li>
<li><a href="#cnf-best-practices-high-level-cnf-restrictions">2.2. CNF restrictions</a></li>
</ul>
</li>
<li><a href="#cnf-best-practices-developer-guide">3. CNF developer guide</a>
<ul class="sectlevel2">
<li><a href="#cnf-best-practices-cloud-native-design-best-practices">3.1. Cloud-native design best practices</a></li>
<li><a href="#cnf-far-edge-best-practices-container-development-best-practices">3.2. Container development best practices</a>
<ul class="sectlevel3">
<li><a href="#cnf-best-practices-pod-exit-status">3.2.1. Pod exit status</a></li>
<li><a href="#cnf-best-practices-graceful-termination">3.2.2. Graceful termination</a></li>
<li><a href="#cnf-best-practices-pod-resource-profiles">3.2.3. Pod resource requests</a></li>
<li><a href="#cnf-best-practices-storage:-emptydir">3.2.4. Storage: emptyDir</a></li>
<li><a href="#cnf-best-practices-liveness-readiness-and-startup-probes">3.2.5. Liveness readiness and startup probes</a></li>
<li><a href="#cnf-best-practices-use-imagepullpolicy:-ifnotpresent">3.2.6. Use imagePullPolicy: IfNotPresent</a></li>
<li><a href="#cnf-best-practices-no-naked-pods">3.2.7. No naked pods</a></li>
<li><a href="#cnf-best-practices-init-containers">3.2.8. init containers</a></li>
<li><a href="#cnf-best-practices-cnf-container-security">3.2.9. Container security best practices</a>
<ul class="sectlevel4">
<li><a href="#cnf-best-practices-avoid-privileged-containers">3.2.9.1. Avoid privileged containers</a></li>
</ul>
</li>
<li><a href="#cnf-best-practices-avoid-accessing-resource-on-host">3.2.10. Avoid accessing resource on host</a></li>
<li><a href="#cnf-best-practices-avoid-mounting-host-directories-as-volumes">3.2.11. Avoid mounting host directories as volumes</a></li>
<li><a href="#cnf-best-practices-avoid-the-host-network-namespace">3.2.12. Avoid the host network namespace</a></li>
<li><a href="#cnf-best-practices-use-of-capabilities">3.2.13. Use of Capabilities</a></li>
</ul>
</li>
<li><a href="#cnf-best-practices-logging">3.3. Logging</a></li>
<li><a href="#cnf-best-practices-upgrade-expectations">3.4. Upgrade expectations</a></li>
<li><a href="#cnf-best-practices-taints-and-tolerations">3.5. Taints and tolerations</a></li>
<li><a href="#cnf-best-practices-requests-limits">3.6. Requests/Limits</a></li>
<li><a href="#cnf-best-practices-security-and-role-based-access-control">3.7. Security and role-based access control</a></li>
<li><a href="#cnf-best-practices-multus">3.8. MULTUS</a></li>
<li><a href="#cnf-far-edge-best-practices-labels">3.9. Labels</a></li>
</ul>
</li>
<li><a href="#cnf-best-practices-far-edge-far-edge-specific-cnf-requirements">4. Far Edge specific CNF requirements</a>
<ul class="sectlevel2">
<li><a href="#cnf-best-practices-far-edge-rt-requirements-and-cpu-engineering">4.1. RT requirements and CPU engineering</a></li>
<li><a href="#cnf-best-practices-far-edge-cpu">4.2. CPU</a>
<ul class="sectlevel3">
<li><a href="#cnf-best-practices-far-edge-application-shared-cpu">4.2.1. Application shared CPU</a></li>
<li><a href="#cnf-best-practices-far-edge-application-exclusive-cpu-pool">4.2.2. Application exclusive CPU pool</a></li>
<li><a href="#cnf-best-practices-far-edge-guidelines-for-the-applications-to-use-cpu-pools">4.2.3. Guidelines for the applications to use CPU pools</a></li>
</ul>
</li>
<li><a href="#cnf-best-practices-far-edge-huge-pages-allocation">4.3. Huge pages allocation</a></li>
<li><a href="#cnf-best-practices-far-edge-hardware-acceleration-easic">4.4. Hardware acceleration (eASIC)</a></li>
<li><a href="#cnf-best-practices-far-edge-ptp-synchronization">4.5. PTP synchronization</a>
<ul class="sectlevel3">
<li><a href="#cnf-best-practices-far-edge-how-to-deploy-and-configure-ptp">4.5.1. How to deploy and configure PTP</a></li>
</ul>
</li>
<li><a href="#cnf-best-practices-cnf-security">4.6. CNF security</a>
<ul class="sectlevel3">
<li><a href="#cnf-best-practices-far-edge-avoid-accessing-resources-on-the-host">4.6.1. Avoid accessing resources on the host</a></li>
<li><a href="#cnf-best-practices-far-edge-avoid-mounting-host-directories-as-volumes">4.6.2. Avoid mounting host directories as volumes</a></li>
<li><a href="#cnf-best-practices-far-edge-avoid-the-host-network-namespace">4.6.3. Avoid the host network namespace</a></li>
</ul>
</li>
<li><a href="#cnf-best-practices-linux-capabilities">4.7. Linux Capabilities</a>
<ul class="sectlevel3">
<li><a href="#cnf-best-practices-default-capabilities">4.7.1. DEFAULT capabilities</a></li>
<li><a href="#cnf-best-practices-ipc_lock">4.7.2. IPC_LOCK</a></li>
<li><a href="#cnf-best-practices-net_admin">4.7.3. NET_ADMIN</a></li>
<li><a href="#cnf-best-practices-avoid-sys_admin">4.7.4. Avoid SYS_ADMIN</a></li>
<li><a href="#cnf-best-practices-sys_nice">4.7.5. SYS_NICE</a></li>
<li><a href="#cnf-best-practices-sys_ptrace">4.7.6. SYS_PTRACE</a></li>
</ul>
</li>
<li><a href="#cnf-best-practices-openshift-operations">4.8. Operations that shall be executed by OpenShift</a>
<ul class="sectlevel3">
<li><a href="#cnf-best-practices-mtu-setting">4.8.1. Setting the MTU</a></li>
<li><a href="#cnf-best-practices-link-state-modification">4.8.2. Modifying link state</a></li>
<li><a href="#cnf-best-practices-ip/mac-address-assignment">4.8.3. Assigning IP/MAC addresses</a></li>
<li><a href="#cnf-best-practices-manipulate-pod’s-route-table">4.8.4. Manipulating pod route tables</a></li>
<li><a href="#cnf-best-practices-sr/iov-vf-setting">4.8.5. Setting SR/IOV VFs</a></li>
<li><a href="#cnf-best-practices-multicast">4.8.6. Configuring multicast</a></li>
</ul>
</li>
<li><a href="#cnf-best-practices-operations-that-can-not-be-executed-by-openshift">4.9. Operations that can not be executed by OpenShift</a></li>
<li><a href="#cnf-best-practices-analyzing-your-application">4.10. Analyzing your application</a></li>
<li><a href="#cnf-best-practices-finding-the-capabilities-that-an-application-needs">4.11. Finding the capabilities that an application needs</a></li>
<li><a href="#cnf-best-practices-cnf-image-security">4.12. Image Security</a></li>
<li><a href="#cnf-best-practices-cnf-securing-cnf-networks">4.13. Securing CNF networks</a>
<ul class="sectlevel3">
<li><a href="#cnf-best-practices-secrets-management">4.13.1. Managing secrets</a>
<ul class="sectlevel4">
<li><a href="#cnf-best-practices-scc-permissions-for-an-application">4.13.1.1. Setting SCC permissions for applications</a></li>
<li><a href="#cnf-best-practices-far-edge-scc-application-categories">4.13.1.2. SCC Application Categories</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><a href="#cnf-best-practices-far-edge-additional-resources">5. Additional resources</a></li>
<li><a href="#cnf-best-practices-copyright">Copyright</a></li>
</ul>
</div>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<!-- toc disabled -->
</div>
</div>
<div class="sect1">
<h2 id="cnf-best-practices-far-edge-introduction"><a class="link" href="#cnf-best-practices-far-edge-introduction">1. Refactoring software as cloud-native network functions</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Software down into the smallest set of microservices as possible.</p>
</div>
<div class="paragraph">
<p>It is hard to move a 1000LB boulder. However, it is easy when that boulder is broken down into many pieces. All containerized network functions (CNFs) should break apart each piece of the functions/services/processes into separate containers. These containers will still be within kubernetes pods and all of the functions that perform a single task should be within the same namespace.</p>
</div>
<div class="paragraph">
<p>There is a <a href="https://martinfowler.com/microservices/">quote</a> from Lewis and Fowler that describes this best:</p>
</div>
<div class="quoteblock">
<blockquote>
The microservice architectural style is an approach to developing a single application as a suite of small services, each running in its own process and communicating with lightweight mechanisms, often an HTTP resource API.These services are built around business capabilities and independently deployable by fully automated deployment machinery.
</blockquote>
<div class="attribution">
&#8212; Lewis and Fowler
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-pods"><a class="link" href="#cnf-best-practices-pods">1.1. Pods</a></h3>
<div class="paragraph">
<p>Pods are the smallest deployable units of computing that can be created and managed in Kubernetes.</p>
</div>
<div class="paragraph">
<p>A Pod can contain one or more running containers at a time. Containers running in the same Pod have access to several of the same Linux namespaces. For example, each application has access to the same network namespace, meaning that one running container can communicate with another running container over <code>127.0.0.1:&lt;port&gt;</code>. The same is true for storage volumes so all containers are in the same Pod have access to the same mount namespace and can mount the same volumes.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cnf-best-practices-expectations-and-permissions"><a class="link" href="#cnf-best-practices-expectations-and-permissions">2. CNF expectations and permissions</a></h2>
<div class="sectionbody">
<div class="sect2">
<h3 id="cnf-best-practices-high-level-cnf-expectations"><a class="link" href="#cnf-best-practices-high-level-cnf-expectations">2.1. High-level CNF expectations</a></h3>
<div class="ulist">
<ul>
<li>
<p>CNFs shall be built to be cloud-native</p>
</li>
<li>
<p>Containers MUST NOT run as root (uid=0). See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-security-context-non-root-user-check">access-control-security-context-non-root-user-check</a></p>
</li>
<li>
<p>Containers MUST run with the minimal set of permissions required. Avoid Privileged Pods. See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-security-context-privilege-escalation">access-control-security-context-privilege-escalation</a></p>
</li>
<li>
<p>Use the main CNI for all traffic - MULTUS/SRIOV/MacVLAN are for corner cases only (extreme throughput requirements, protocols that are unable to be load balanced)</p>
</li>
<li>
<p>CNFs should employ N+k redundancy models (not applicable for Far Edge)</p>
</li>
<li>
<p>CNFs MUST define their pod affinity/anti-affinity rules. See test cases <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#lifecycle-affinity-required-pods">lifecycle-affinity-required-pods</a>, <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#lifecycle-pod-high-availability">lifecycle-pod-high-availability</a></p>
</li>
<li>
<p>All secondary network interfaces employed by CNFs with the use of MULTUS MUST support Dual-Stack IPv4/IPv6.</p>
</li>
<li>
<p>Instantiation of CNF (via Helm chart or Operators or otherwise) shall result in a fully-functional CNF ready to serve traffic, without requiring any post-instantiation configuration of system parameters</p>
</li>
<li>
<p>CNFs shall implement service resilience at the application layer and not rely on individual compute availability/stability</p>
</li>
<li>
<p>CNFs shall decouple application configuration from Pods, to allow dynamic configuration updates</p>
</li>
<li>
<p>CNFs shall support elasticity with dynamic scale up/down using kubernetes-native constructs such as ReplicaSets, etc. See test cases <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#lifecycle-crd-scaling">lifecycle-crd-scaling</a>, <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#lifecycle-statefulset-scaling">lifecycle-statefulset-scaling</a>, <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#lifecycle-deployment-scaling">lifecycle-deployment-scaling</a></p>
</li>
<li>
<p>CNFs shall support canary upgrades</p>
</li>
<li>
<p>CNFs shall self-recover from common failures like pod failure, host failure, and network failure. Kubernetes native mechanisms such as health-checks (Liveness, Readiness and Startup Probes) shall be employed at a minimum. See test cases <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#lifecycle-liveness-probe">lifecycle-liveness-probe</a>, <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#lifecycle-readiness-probe">lifecycle-readiness-probe</a>, <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#lifecycle-startup-probe">lifecycle-startup-probe</a></p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Containers must not run as root</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-security-context-non-root-user-check">access-control-security-context-non-root-user-check</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>All secondary interfaces (MULTUS) must support dual stack</p>
</div>
<div class="paragraph">
<p>See test cases <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#networking-icmpv4-connectivity-multus">networking-icmpv4-connectivity-multus</a>, <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#networking-icmpv6-connectivity-multus">networking-icmpv6-connectivity-multus</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>CNFs shall not use node selectors nor taints/tolerations to assign pod location</p>
</div>
<div class="paragraph">
<p>See test cases <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#lifecycle-pod-scheduling">lifecycle-pod-scheduling</a>, <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#platform-alteration-tainted-node-kernel">platform-alteration-tainted-node-kernel</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-high-level-cnf-restrictions"><a class="link" href="#cnf-best-practices-high-level-cnf-restrictions">2.2. CNF restrictions</a></h3>
<div class="ulist">
<ul>
<li>
<p>CNFs may not use host networking</p>
</li>
<li>
<p>Namespace should not be created by the CNFs deployment method (Helm / Operator)</p>
</li>
<li>
<p>CNFs may not perform Role creation</p>
</li>
<li>
<p>CNFs may not perform Rolebinding creation</p>
</li>
<li>
<p>CNFs may not have Cluster Roles</p>
</li>
<li>
<p>CNFs are not authorized to bring their own CNI</p>
</li>
<li>
<p>CNFs may not deploy Daemonsets</p>
</li>
</ul>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cnf-best-practices-developer-guide"><a class="link" href="#cnf-best-practices-developer-guide">3. CNF developer guide</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>This section discusses recommendations and requirements for CNF application builders.</p>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-cloud-native-design-best-practices"><a class="link" href="#cnf-best-practices-cloud-native-design-best-practices">3.1. Cloud-native design best practices</a></h3>
<div class="paragraph">
<p>The following best practices highlight some key principles of cloud-native application design.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Single purpose w/messaging interface</dt>
<dd>
<p>A container should address a single purpose with a well-defined (typically RESTful API) messaging interface. The motivation here is that such a container image is more reusable and more replaceable/upgradeable.</p>
</dd>
<dt class="hdlist1">High observability</dt>
<dd>
<p>A container must provide APIs for the platform to observe the container health and act accordingly. These APIs include health checks (liveness and readiness), logging to stderr and stdout for log aggregation (by tools such as <code>Logstash</code> or <code>Filebeat</code>), and integrate with tracing and metrics-gathering libraries (such as <code>Prometheus</code> or <code>Metricbeat</code>).</p>
</dd>
<dt class="hdlist1">Lifecycle conformance</dt>
<dd>
<p>A container must receive important events from the platform and conform/react to these events properly. For example, a container should catch SIGTERM or SIGKILL from the platform and shut down as quickly as possible. Other typically important events from the platform are PostStart to initialize before servicing requests and PreStop to release resources cleanly before shutting down.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>See test cases <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#lifecycle-container-shutdown">lifecycle-container-shutdown</a>, <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#lifecycle-container-startup">lifecycle-container-startup</a></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Image immutability</dt>
<dd>
<p>Container images are meant to be immutable; i.e. customized images for different environments should typically not be built. Instead, an external means for storing and retrieving configurations that vary across environments for the container should be used. Additionally, the container image should NOT dynamically install additional packages at runtime.</p>
</dd>
<dt class="hdlist1">Process disposability</dt>
<dd>
<p>Containers should be as ephemeral as possible and ready to be replaced by another container instance at any point in time. There are many reasons to replace a container, such as failing a health check, scaling down the application, migrating the containers to a different host, platform resource starvation, or another issue.</p>
<div class="paragraph">
<p>This means that containerized applications must keep their state externalized or distributed and redundant. To store files or block level data, persistent volume claims should be used. For information such as user sessions, use of an external, low-latency, key-value store such as redis should be used. Process disposability also requires that the application should be quick in starting up and shutting down, and even be ready for a sudden, complete hardware failure.</p>
</div>
<div class="paragraph">
<p>Another helpful practice in implementing this principle is to create small containers. Containers in cloud-native environments may be automatically scheduled and started on different hosts. Having smaller containers leads to quicker start-up times because before being restarted, containers need to be physically copied to the host system.</p>
</div>
<div class="paragraph">
<p>A corollary of this practice is to "retry instead of crashing", for example, When one service in your application depends on another service, it should not crash when the other service is unreachable. For example, your API service is starting up and detects the database is unreachable. Instead of failing and refusing to start, you design it to retry the connection. While the database connection is down the API can respond with a 503 status code, telling the clients that the service is currently unavailable. This practice should already be followed by applications, but if you are working in a containerized environment where instances are disposable, then the need for it becomes more obvious.</p>
</div>
<div class="paragraph">
<p>Also related to this, by default containers are launched with shared images using COW filesystems which only exist as long as the container exists. Mounting Persistent Volume Claims enables a container to have persistent physical storage. Clearly defining the abstraction for what storage is persisted promotes the idea that instances are disposable.</p>
</div>
</dd>
<dt class="hdlist1">Horizontal scaling and redundancy</dt>
<dd>
<p>Support scaling and/or redundancy of your application through increasing/decreasing the number of application pods in your deployment, rather than requiring increased/decreased resources for a single application pod.</p>
<div class="paragraph">
<p>Also follow the principles described in <strong>Process Disposability</strong>, i.e. stateless containers with quick startup and teardown times.</p>
</div>
</dd>
<dt class="hdlist1">Self-containment</dt>
<dd>
<p>A container should contain everything it needs at build time. The container should rely only on the presence of the Linux kernel and have any additional libraries added into it at the time the container is built. The container image should NOT dynamically install additional packages at runtime.</p>
<div class="paragraph">
<p>The only exceptions are things such as configurations, which vary between different environments and must be provided at runtime; for example, through Kubernetes ConfigMap</p>
</div>
</dd>
<dt class="hdlist1">Runtime confinement</dt>
<dd>
<p>A container declares its resource requirements (cpu, memory, networking, disk) to the platform. The container must stay confined to the indicated resource requirements.</p>
</dd>
<dt class="hdlist1">Use small container images</dt>
<dd>
<p>Use the smallest base image possible. To reduce the size of your image, install only what is strictly needed inside it. Clean up temporary files and avoid the installation of unnecessary packages. This reduces container size, build time, and networking time when copying container images. Layer squashing may also be leveraged to hide secrets.</p>
</dd>
<dt class="hdlist1">Layer the application</dt>
<dd>
<p>Package a single app per container. Do not replace VM’s with containers. Try to create images with common layers. After the initial download, only the layers that make each image unique are needed, thereby reducing the overhead on downloads.</p>
</dd>
<dt class="hdlist1">Image tagging</dt>
<dd>
<p>Never build off the latest tag—this prevents builds from being reproducible over time. Properly tag your images. Tagging the image lets users identify a specific version of your software in order to download it. For this reason, tightly link the tagging system on container images to the release policy of your software.</p>
</dd>
</dl>
</div>
</div>
<div class="sect2">
<h3 id="cnf-far-edge-best-practices-container-development-best-practices"><a class="link" href="#cnf-far-edge-best-practices-container-development-best-practices">3.2. Container development best practices</a></h3>
<div class="sect3">
<h4 id="cnf-best-practices-pod-exit-status"><a class="link" href="#cnf-best-practices-pod-exit-status">3.2.1. Pod exit status</a></h4>
<div class="paragraph">
<p>The most basic requirement for the lifecycle management of pods in OpenShift is the ability to start and stop correctly. When starting up, health probes like liveness and readiness checks can be put into place to ensure the application is functioning properly.</p>
</div>
<div class="paragraph">
<p>There are different ways a pod can be stopped in Kubernetes. One way is that the pod can remain alive but non-functional. Another way is that the pod can crash and become non-functional. In the first case, if the administrator has implemented liveness and readiness checks, OpenShift can stop the pod and either restart it on the same node or a different node in the cluster. For the second case, when the application in the pod stops, it should exit with a code and write suitable log entries to help the administrator diagnose what the issue was that caused the problem.</p>
</div>
<div class="paragraph">
<p>Pods should use <code>terminationMessagePolicy: FallbackToLogsOnError</code> to summarize why they crashed and use stderr to report errors on crash</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#observability-termination-policy">observability-termination-policy</a></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>All pods shall have a liveness, readiness and startup probes defined</p>
</div>
<div class="paragraph">
<p>See test cases <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#lifecycle-liveness-probe">lifecycle-liveness-probe</a>, <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#lifecycle-readiness-probe">lifecycle-readiness-probe</a>, <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#lifecycle-startup-probe">lifecycle-startup-probe</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>OpenShift Container Platform and Kubernetes give application instances time to shut down before
removing them from load balancing rotations. However, applications must ensure they cleanly
terminate user connections as well before they exit.</p>
</div>
<div class="paragraph">
<p>On shutdown, OpenShift Container Platform sends a TERM signal to the processes in the container.
Application code, on receiving SIGTERM, stop accepting new connections. This ensures that load
balancers route traffic to other active instances. The application code then waits until all open
connections are closed, or gracefully terminate individual connections at the next opportunity, before exiting.</p>
</div>
<div class="paragraph">
<p>After the graceful termination period expires, a process that has not exited is sent the KILL signal,
which immediately ends the process. The <code>terminationGracePeriodSeconds</code> attribute of a pod or pod
template controls the graceful termination period (default 30 seconds) and can be customized per
application as necessary.</p>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-graceful-termination"><a class="link" href="#cnf-best-practices-graceful-termination">3.2.2. Graceful termination</a></h4>
<div class="paragraph">
<p>There are different reasons that a pod may need to shutdown on an OpenShift cluster. It might be that the node the pod is running on needs to be shut down for maintenance, or the administrator is doing a rolling update of an application to a new version which requires that the old versions are shutdown properly.</p>
</div>
<div class="paragraph">
<p>When pods are shut down by the platform they are sent a <code>SIGTERM</code> signal which means that the process in the container should start shutting down, closing connections and stopping all activity. If the pod doesn&#8217;t shut down within the default 30 seconds then the platform may send a <code>SIGKILL</code> signal which will stop the pod immediately. This method isn&#8217;t as clean and the default time between the <code>SIGTERM</code> and <code>SIGKILL</code> messages can be modified based on the requirements of the application.</p>
</div>
<div class="paragraph">
<p>Pods should exit with zero exit codes when they are gracefully terminated.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>All pods must respond to SIGTERM signal and shutdown gracefully with a zero exit code.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#lifecycle-container-shutdown">lifecycle-container-shutdown</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-pod-resource-profiles"><a class="link" href="#cnf-best-practices-pod-resource-profiles">3.2.3. Pod resource requests</a></h4>
<div class="paragraph">
<p>CaaS Platform has a default scheduler that is responsible for being aware of the current available resources on the platform, and placing containers / applications on the platform appropriately.</p>
</div>
<div class="paragraph">
<p>All pods should have a resource request that is the minimum amount of resources the pod is expected to use at steady state for both memory and CPU.</p>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-storage:-emptydir"><a class="link" href="#cnf-best-practices-storage:-emptydir">3.2.4. Storage: emptyDir</a></h4>
<div class="paragraph">
<p>There are several options for volumes and reading and writing files in OpenShift. When the requirement is temporary storage and given the option to write files into directories in containers versus an external filesystems, choose the <code>emptyDir</code> option. This will provide the administrator with the same temporary filesystem - when the pod is stopped the dir is deleted forever. Also, the <code>emptyDir</code> can be backed by whatever medium is backing the node, or it can be set to memory for faster reads and writes.</p>
</div>
<div class="paragraph">
<p>Using <code>emptyDir</code> with requested local storage limits instead of writing to the container directories also allows enabling <code>readonlyRootFilesystem</code> on the container or pod.</p>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-liveness-readiness-and-startup-probes"><a class="link" href="#cnf-best-practices-liveness-readiness-and-startup-probes">3.2.5. Liveness readiness and startup probes</a></h4>
<div class="paragraph">
<p>As part of the pod lifecycle, the OpenShift platform needs to know what state the pod is in at all times. This can be accomplished with different health checks. There are at least three states that are important to the platform: startup, running, shutdown. Applications can also be running, but not healthy, meaning, the pod is up and the application shows no errors, but it cannot serve any requests.</p>
</div>
<div class="paragraph">
<p>When an application starts up on OpenShift it may take a while for the application to become ready to accept connections from clients, or perform whatever duty it is intended for.</p>
</div>
<div class="paragraph">
<p>Two health checks that are required to monitor the status of the applications are liveness and readiness. As mentioned above, the application can be running but not actually able to serve requests. This can be detected with liveness checks. The liveness check will send specific requests to the application that, if satisfied, indicate that the pod is in a healthy state and operating within the required parameters that the administrator has set. A failed liveness check will result in the container being restarted.</p>
</div>
<div class="paragraph">
<p>There is also a consideration of pod startup. Here the pod may start and take a while for different reasons. Pods can be marked as ready if they pass the readiness check. The readiness check determines that the pod has started properly and is able to answer requests. There are circumstances where both checks are used to monitor the applications in the pods. A failed readiness check results in the container being taken out of the available service endpoints. An example of this being relevant is when the pod was under heavy load, failed the readiness check, gets taken out of the endpoint pool, processes requests, passes the readiness check and is added back to the endpoint pool.</p>
</div>
<div class="paragraph">
<p>For more information, see <a href="https://kubernetes.io/docs/tasks/configure-pod-container/configure-liveness-readiness-startup-probes/">Configure Liveness, Readiness and Startup Probes</a>.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p><a href="https://docs.openshift.com/container-platform/latest/applications/application-health.html">Exec probes</a> need to be avoided at all cost because of the resource overhead the require. Exec probes cannot be used on RT containers.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See test cases <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#lifecycle-liveness-probe">lifecycle-liveness-probe</a>, <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#lifecycle-readiness-probe">lifecycle-readiness-probe</a>, <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#lifecycle-startup-probe">lifecycle-startup-probe</a></p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the CNF is doing CPU pinning and running a DPDK process do not use exec probes (executing a command within the container); as this can pile up and eventually block the node.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#networking-dpdk-cpu-pinning-exec-probe">networking-dpdk-cpu-pinning-exec-probe</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-use-imagepullpolicy:-ifnotpresent"><a class="link" href="#cnf-best-practices-use-imagepullpolicy:-ifnotpresent">3.2.6. Use imagePullPolicy: IfNotPresent</a></h4>
<div class="paragraph">
<p>If there is a situation where the container dies and needs to be restarted, the image pull policy becomes important. There are three image pull policies available: <code>Always</code>, <code>Never</code> and <code>IfNotPresent</code>. It is generally recommended to have a pull policy of <code>IfNotPresent</code>. This means that the if pod needs to restart for any reason, the kubelet will check on the node where the pod is starting and reuse the already downloaded container image if it&#8217;s available. OpenShift intentionally does not set <code>AlwaysPullImages</code> as turning on this admission plugin can introduce new kinds of cluster failure modes. Self-hosted infrastructure components are still pods: enabling this feature can result in cases where a loss of contact to an image registry can cause redeployment of an infrastructure or application pod to fail. We use <code>PullIfNotPresent</code> so that a loss of image registry access does not prevent the pod from restarting.</p>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Container images that are protected by registry authentication have a condition whereby a user who is unable to download an image directly can still launch it by leveraging the host&#8217;s cached image.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#lifecycle-image-pull-policy">lifecycle-image-pull-policy</a></p>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-no-naked-pods"><a class="link" href="#cnf-best-practices-no-naked-pods">3.2.7. No naked pods</a></h4>
<div class="paragraph">
<p>Do not use naked Pods (that is, Pods not bound to a <code>ReplicaSet</code>, or <code>StatefulSet</code> deployment). Naked pods will not be rescheduled in the event of a node failure.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#lifecycle-pod-owner-type">lifecycle-pod-owner-type</a></p>
</div>
<div class="paragraph">
<p>CNF requirement</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Applications must not depend on any single pod being online for their application to function.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Pods must be deployed as part of a <code>Deployment</code> or <code>StatefulSet</code>.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#lifecycle-pod-owner-type">lifecycle-pod-owner-type</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Pods may not be deployed in a DaemonSet.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#lifecycle-pod-owner-type">lifecycle-pod-owner-type</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-init-containers"><a class="link" href="#cnf-best-practices-init-containers">3.2.8. init containers</a></h4>
<div class="paragraph">
<p>init containers can be used for running tools or commands or any other action that needs to be done before the actual pod is started. For example, loading a database schema, or constructing a config file from a definition passed in via <code>ConfigMap</code> or <code>Secret</code>.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.openshift.com/container-platform/4.12/nodes/containers/nodes-containers-init.html">Using init containers to perform tasks before a pod is deployed</a> for more information.</p>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-cnf-container-security"><a class="link" href="#cnf-best-practices-cnf-container-security">3.2.9. Container security best practices</a></h4>
<div class="sect4">
<h5 id="cnf-best-practices-avoid-privileged-containers"><a class="link" href="#cnf-best-practices-avoid-privileged-containers">3.2.9.1. Avoid privileged containers</a></h5>
<div class="paragraph">
<p>In OpenShift Container Platform, it is possible to run privileged containers that have all of the root capabilities on a host machine, allowing the ability to access resources which are not accessible in ordinary containers. This, however, increases the security risk to the whole cluster. Containers should only request those privileges they need to run their legitimate functions. No containers will be allowed to run with full privileges without an exception.</p>
</div>
<div class="paragraph">
<p>The general guidelines are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Only ask for the necessary privileges and access control settings for your application.</p>
</li>
<li>
<p>If the function required by your CNF can be fulfilled by OCP components, your application should not be requesting escalated privilege to perform this function.</p>
</li>
<li>
<p>Avoid using any host system resource if possible.</p>
</li>
<li>
<p>Leveraging read only root filesystem when possible.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-avoid-accessing-resource-on-host"><a class="link" href="#cnf-best-practices-avoid-accessing-resource-on-host">3.2.10. Avoid accessing resource on host</a></h4>
<div class="paragraph">
<p>It is not recommended for an application to access following resources on the host.</p>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-avoid-mounting-host-directories-as-volumes"><a class="link" href="#cnf-best-practices-avoid-mounting-host-directories-as-volumes">3.2.11. Avoid mounting host directories as volumes</a></h4>
<div class="paragraph">
<p>It is not necessary to mount host <code>/sys/</code> or host <code>/dev/</code> directories as a volume in a pod in order to use a network device such as SR-IOV VF. The moving of a network interface into the pod network namespace is done automatically by CNI. Mounting the whole <code>/sys/</code> or <code>/dev/</code> directory in the container will overwrite the network device descriptor inside the container which causes <code>device not found</code> or <code>no such file or directory</code> error.</p>
</div>
<div class="paragraph">
<p>Network interface statistics can be queried inside the container using the same <code>/sys/</code> path as was done when running directly on the host. When running network interfaces in containers, relevant <code>/sys/</code> statistics interfaces are available inside the container, such as <code>/sys/class/net/net1/statistics/</code>, <code>/proc/net/tcp</code> and <code>/proc/net/tcp6</code>.</p>
</div>
<div class="paragraph">
<p>For running DPDK applications with SR-IOV VF, device specs (in case of vfio-pci) are automatically attached to the container via the Device Plugin. There is no need to mount the /dev/ directory as a volume in the container as the application can find device specs under <code>/dev/vfio/</code> in the container.</p>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-avoid-the-host-network-namespace"><a class="link" href="#cnf-best-practices-avoid-the-host-network-namespace">3.2.12. Avoid the host network namespace</a></h4>
<div class="paragraph">
<p>Application pods must avoid using <code>hostNetwork</code>. Applications may not use the host network, including <code>nodePort</code>, for network communication. Any networking needs beyond the functions provided by the pod network and ingress/egress proxy must be serviced via a MULTUS connected interface.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Applications may not use <code>NodePorts</code> or the <code>hostNetwork</code>.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-service-type">access-control-service-type</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-use-of-capabilities"><a class="link" href="#cnf-best-practices-use-of-capabilities">3.2.13. Use of Capabilities</a></h4>
<div class="paragraph">
<p>Linux Capabilities allow you to break apart the power of root into smaller groups of privileges. Platform administrators can use Pod Security Policy (PSP) to control permissions for pods. Users can also specify the necessary Security Context in the pod annotations.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">IPC_LOCK</dt>
<dd>
<p>IPC_LOCK capability is required if any of these functions are used in an application:</p>
<div class="ulist">
<ul>
<li>
<p><code>mlock()</code></p>
</li>
<li>
<p><code>mlockall()</code></p>
</li>
<li>
<p><code>shmctl()</code></p>
</li>
<li>
<p><code>mmap()</code></p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>Even though ‘mlock’ is not necessary on systems where page swap is disabled, it may still be required as it is a function that is built into DPDK libraries, and DPDK based applications may indirectly call it by calling other functions.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">NET_ADMIN</dt>
<dd>
<p>NET_ADMIN capability is required to perform various network related administrative operations inside container such as:</p>
<div class="ulist">
<ul>
<li>
<p>MTU setting</p>
</li>
<li>
<p>Link state modification</p>
</li>
<li>
<p>MAC/IP address assignment</p>
</li>
<li>
<p>IP address flushing</p>
</li>
<li>
<p>Route insertion/deletion/replacement</p>
</li>
<li>
<p>Control network driver and hardware settings via ‘ethtool’</p>
</li>
</ul>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This doesn&#8217;t include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>adding or deleting a virtual interface inside a container. For example: adding a VLAN interface</p>
</li>
<li>
<p>Setting VF device properties</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All the administrative operations (except <code>ethtool</code>) mentioned above that require the NET_ADMIN capability should already be supported on the host by various CNIs on CaaS Platform.</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Avoid SYS_ADMIN</dt>
<dd>
<p>This capability is very powerful and overloaded. It allows the application to perform a range of system administration operations to the host. So you should avoid requiring this capability in your application.</p>
</dd>
<dt class="hdlist1">SYS_NICE</dt>
<dd>
<p>In the case that a CNF is using the real-time kernel. SYS_NICE is needed to allow DPDK application to switch to SCHED_FIFO</p>
</dd>
<dt class="hdlist1">SYS_PTRACE</dt>
<dd>
<p>This capability is required when using Process Namespace Sharing. This is used when processes from one Container need to be exposed to another Container. For example, to send signals like <code>SIGHUP</code> from a process in a Container to another process in another Container.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-logging"><a class="link" href="#cnf-best-practices-logging">3.3. Logging</a></h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Log aggregation and analysis</dt>
</dl>
</div>
<div class="openblock">
<div class="content">
<div class="ulist">
<ul>
<li>
<p>Containers are expected to write logs to stdout. It is highly recommended that stdout/stderr leverage some standard logging format for output.</p>
</li>
<li>
<p>Logs CAN be parsed to a limited extent so that specific vendor logs can be sent back to the CNF if required.</p>
</li>
<li>
<p>Logs need to be properly labeled for logs’ consumer to correlate and process</p>
</li>
<li>
<p>CNFs requiring log parsing must leverage some standard logging library or format for all stdout/stderr. Examples of standard logging libraries include; <code>klog</code>, <code>rfc5424</code>, and <code>oslo</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#observability-container-logging">observability-container-logging</a></p>
</div>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-upgrade-expectations"><a class="link" href="#cnf-best-practices-upgrade-expectations">3.4. Upgrade expectations</a></h3>
<div class="ulist">
<ul>
<li>
<p>The Kubernetes API deprecation policy defined in <a href="https://kubernetes.io/docs/reference/using-api/deprecation-policy/">Kubernetes Deprecation Policy</a> shall be followed.</p>
</li>
<li>
<p>CNFs are expected to maintain service continuity during platform upgrades, and during CNF version upgrades</p>
</li>
<li>
<p>CNFs need to be prepared for nodes to reboot or shut down without notice</p>
</li>
<li>
<p>CNFs shall configure pod disruption budget appropriately to maintain service continuity during platform upgrades</p>
</li>
<li>
<p><strong>Applications may NOT deploy pod disruption budgets that prevent zero pod disruption.</strong></p>
</li>
<li>
<p>Applications should not be tied to a specific version of Kubernetes or any of its components</p>
</li>
</ul>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="paragraph">
<p>Applications MUST specify a pod disruption budget appropriately to maintain service continuity during platform upgrades. The budget should be defined with a balance such that it allows operational flexibility for the cluster to drain nodes, but restrictive enough so that the service is not degraded over upgrades.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#lifecycle-pod-recreation">lifecycle-pod-recreation</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Pods that perform the same microservice and that could be disrupted if multiple members of the service are
unavailable must implement pod disruption budgets to prevent disruption in the event of patches/upgrades.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#observability-pod-disruption-budget">observability-pod-disruption-budget</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-taints-and-tolerations"><a class="link" href="#cnf-best-practices-taints-and-tolerations">3.5. Taints and tolerations</a></h3>
<div class="paragraph">
<p>Taints and tolerations allow the node to control which pods are scheduled on the node. A taint allows a node to refuse a pod to be scheduled unless that pod has a matching toleration.</p>
</div>
<div class="paragraph">
<p>You apply taints to a node through the node specification (<code>NodeSpec</code>) and apply tolerations to a pod through the pod specification (<code>PodSpec</code>). A taint on a node instructs the node to repel all pods that do not tolerate the taint.</p>
</div>
<div class="paragraph">
<p>Taints and tolerations consist of a key, value, and effect. An operator allows you to leave one of these parameters empty.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.openshift.com/container-platform/latest/nodes/scheduling/nodes-scheduler-taints-tolerations.html">Controlling pod placement using node taints</a> for more information.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#platform-alteration-tainted-node-kernel">platform-alteration-tainted-node-kernel</a></p>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-requests-limits"><a class="link" href="#cnf-best-practices-requests-limits">3.6. Requests/Limits</a></h3>
<div class="paragraph">
<p>Requests and limits provide a way for a CNF developer to ensure they have adequate resources available to run the application. Requests can be made for storage, memory, CPU and so on. These requests and limits can be enforced by quotas. Quotas can be used as a way to enforce requests and limits. See <a href="https://docs.openshift.com/container-platform/latest/applications/quotas/quotas-setting-per-project.html">Resource quotas per project</a> for more information.</p>
</div>
<div class="paragraph">
<p>Nodes can be overcommitted which can affect the strategy of request/limit implementation. For example, when you need guaranteed capacity, use quotas to enforce. In a development environment, you can overcommit where a trade-off of guaranteed performance for capacity is acceptable. Overcommitment can be done on a project, node or cluster level.</p>
</div>
<div class="paragraph">
<p>See <a href="https://docs.openshift.com/container-platform/latest/nodes/clusters/nodes-cluster-overcommit.html">Configuring your cluster to place pods on overcommitted nodes</a> for more information.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Pods must define requests and limits values for CPU and memory.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-requests-and-limits">access-control-requests-and-limits</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-security-and-role-based-access-control"><a class="link" href="#cnf-best-practices-security-and-role-based-access-control">3.7. Security and role-based access control</a></h3>
<div class="dlist">
<dl>
<dt class="hdlist1">Roles / RoleBindings</dt>
<dd>
<p>A <code>Role</code> represents a set of permissions within a particular namespace. E.g: A given user can list pods/services within the namespace. The <code>RoleBinding</code> is used for granting the permissions defined in a role to a user or group of users. Applications may create roles and rolebindings within their namespace, however the scope of a role will be limited to the same permissions that the creator has or less.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-pod-role-bindings">access-control-pod-role-bindings</a></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">ClusterRole / ClusterRoleBinding</dt>
<dd>
<p>A <code>ClusterRole</code> represents a set of permissions at the cluster level that can be used by multiple namespaces. The <code>ClusterRoleBinding</code> is used for granting the permissions defined in a <code>ClusterRole</code> to a user or group of users at a namespace level. Applications are not permitted to install cluster roles or create cluster role bindings. This is an administrative activity done by cluster administrators. CNFs should not use cluster roles; exceptions can be granted to allow this, however this is discouraged. It is recommended to define a set of allowed roles and allow binding to these only. Avoid using cluster roles for CNFs, instead use Roles local to the namespace where the CNF is deployed.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>See <a href="https://docs.openshift.com/container-platform/4.7/authentication/using-rbac.html">Using RBAC to define and apply permissions</a> for more information.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>CNFs may not create <code>ClusterRole</code> or <code>ClusterRoleBinding</code> CRs. Only cluster administrators should create these CRs.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-cluster-role-bindings">access-control-cluster-role-bindings</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-multus"><a class="link" href="#cnf-best-practices-multus">3.8. MULTUS</a></h3>
<div class="paragraph">
<p>MULTUS is a meta-CNI that allows multiple CNIs that it delegates to. This allows pods to get additional interfaces beyond <code>eth0</code> via additional CNIs. Having additional CNIs for SR-IOV and MacVLAN interfaces allow for direct routing of traffic to a pod without using the pod network via additional interfaces. This capability is being delivered for use in only corner case scenarios, it is not to be used in general for all applications. Example use cases include bandwidth requirements that necessitate SR-IOV and protocols that are unable to be supported by the load balancer. The OVN based pod network should be used for every interface that can be supported from a technical standpoint.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Unless an application has a special traffic requirement that is not supported by SPK or ovn-kubernetes CNI
the applications must use the pod network for traffic</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>See <a href="https://docs.openshift.com/container-platform/latest/networking/multiple_networks/understanding-multiple-networks.html">Understanding multiple networks</a> for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="cnf-far-edge-best-practices-labels"><a class="link" href="#cnf-far-edge-best-practices-labels">3.9. Labels</a></h3>
<div class="paragraph">
<p>Labels are used to organize and select subsets of objects. For example, labels enable a service to find and direct traffic to an appropriate pod. While pods can come and go, when labeled appropriately, the service will detect new pods, or a lack of pods, and forward or reduce the traffic accordingly.</p>
</div>
<div class="paragraph">
<p>When designing your label scheme, it might make sense to map applications as types, location, departments, roles, etc. The scheduler will then use these attributes when colocating pods or spreading the pods out amongst the cluster. It is also possible to search for resources by label.</p>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cnf-best-practices-far-edge-far-edge-specific-cnf-requirements"><a class="link" href="#cnf-best-practices-far-edge-far-edge-specific-cnf-requirements">4. Far Edge specific CNF requirements</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>Due to the specific deployment environment at the very far edge of the network, and the different CaaS/PaaS vendors being selected by Far Edge vs. Core/Edge, there are some Far Edge specific CNF requirements that are described in the following sections.</p>
</div>
<div class="paragraph">
<p>At the Far Edge, OpenShift is deployed as a Single Node OpenShift (SNO) cluster.</p>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-far-edge-rt-requirements-and-cpu-engineering"><a class="link" href="#cnf-best-practices-far-edge-rt-requirements-and-cpu-engineering">4.1. RT requirements and CPU engineering</a></h3>
<div class="paragraph">
<p>In regards to CPU engineering and layout, the platform infrastructure Pods and operating system processes will require CPU resources in addition to workload requirements. To facilitate these requirements workload partitioning and performance profiles are used in tandem to accommodate this. The workload partitioning should be set up during the installation of the SNO cluster. An example cluster manifest is <a href="https://docs.openshift.com/container-platform/latest/scalability_and_performance/enabling-workload-partitioning.html">here</a>.</p>
</div>
<div class="paragraph">
<p>Provided that these manifests are created at runtime, the <code>machineConfig</code> can be changed to modify the number of cores allocated to the house keeping pods and processes. Additionally, these partition manifests must correspond to the same configuration as the <a href="https://docs.openshift.com/container-platform/latest/scalability_and_performance/ztp_far_edge/ztp-reference-cluster-configuration-for-vdu.html#ztp-sno-du-configuring-performance-addons_sno-configure-for-vdu">performance profile</a>..</p>
</div>
<div class="paragraph">
<p>This configuration can be verified by examining the allowed CPUs for systemd:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">#</span><span class="w"> </span><span class="nb">cat</span> /proc/1/status|grep Cpus_allowed_list
<span class="go">Cpus_allowed_list: 0-1,32-33</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Housekeeping pods should have the following annotation in their namespace:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">annotations</span><span class="pi">:</span>
  <span class="na">workload.openshift.io/allowed</span><span class="pi">:</span> <span class="s">management</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>This ensures they are given access to the same cores as above. More information can be found in the <a href="https://docs.openshift.com/container-platform/latest/scalability_and_performance/enabling-workload-partitioning.html">workload partitioning</a> documentation.</p>
</div>
<div class="paragraph">
<p>The platform provides the different types of CPU pools to the various application threads. The low-latency application, like vRAN, should be designed and implemented properly to fully utilize this platform. More information can be found in the <a href="https://docs.openshift.com/container-platform/4.13/scalability_and_performance/cnf-low-latency-tuning.html">Low latency tuning</a> documentation.</p>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-far-edge-cpu"><a class="link" href="#cnf-best-practices-far-edge-cpu">4.2. CPU</a></h3>
<div class="sect3">
<h4 id="cnf-best-practices-far-edge-application-shared-cpu"><a class="link" href="#cnf-best-practices-far-edge-application-shared-cpu">4.2.1. Application shared CPU</a></h4>
<div class="paragraph">
<p>The burstable workload can float around on the CPUs depending on the availability of resources. More information can be found in the <a href="https://docs.openshift.com/container-platform/4.13/scalability_and_performance/cnf-low-latency-tuning.html">Low latency tuning</a> documentation.</p>
</div>
<div class="paragraph">
<p>The Workload that is not sensitive to CPU migration and context switching, e.g. OAM, is suitable for using the shared CPU pool. For more information see the Kubernetes <a href="https://kubernetes.io/docs/tasks/configure-pod-container/quality-service-pod/#create-a-pod-that-gets-assigned-a-qos-class-of-burstable">Pod QoS class</a> docs.</p>
</div>
<div class="paragraph">
<p>CPU resource request example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">resources</span><span class="pi">:</span>
      <span class="c1"># Container is in the application shared CPU pool</span>
      <span class="na">requests</span><span class="pi">:</span>
        <span class="c1"># CPU request is not an integer</span>
        <span class="na">cpu</span><span class="pi">:</span> <span class="s">100m</span>
      <span class="na">limits</span><span class="pi">:</span>
        <span class="na">cpu</span><span class="pi">:</span> <span class="s">200m</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-far-edge-application-exclusive-cpu-pool"><a class="link" href="#cnf-best-practices-far-edge-application-exclusive-cpu-pool">4.2.2. Application exclusive CPU pool</a></h4>
<div class="paragraph">
<p>CPUsets constrain the CPU and memory placement of task to the resources within a task’s current cpuset. Within cgroup, the workload can set CPU affinity to reduce the context switching, however CPU scheduler still performs load balances for non-cpu-pinned workload across all the CPUs in the cpuset. In addition, the following annotation is required to accompany the workload. See <a href="https://docs.openshift.com/container-platform/4.11/scalability_and_performance/cnf-low-latency-tuning.html#disabling-cpu-cfs-quota_cnf-master">Disabling CPU CFS quota</a>:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">performance.openshift.io/v2</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">cpu-quota.crio.io</span><span class="pi">:</span> <span class="s2">"</span><span class="s">disable"</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">runtimeClassName</span><span class="pi">:</span> <span class="s">performance-&lt;profile_name&gt;</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>A workload should use Application exclusive CPU pool if it has CPU low-latency requirement. However, the workload should allow context switching with other application threads and kernel threads in the <code>cpuset</code>. An example workload that uses application exclusive pool is a vRAN RT task.</p>
</div>
<div class="paragraph">
<p>CPU resource request example:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">resources</span><span class="pi">:</span>
      <span class="c1"># Container is in the application exclusive CPU pool</span>
      <span class="na">requests</span><span class="pi">:</span>
        <span class="c1"># CPU request is an integer and matches with limits</span>
        <span class="na">cpu</span><span class="pi">:</span> <span class="m">2</span>
      <span class="na">limits</span><span class="pi">:</span>
        <span class="na">cpu</span><span class="pi">:</span> <span class="s">2</span></code></pre>
</div>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-far-edge-guidelines-for-the-applications-to-use-cpu-pools"><a class="link" href="#cnf-best-practices-far-edge-guidelines-for-the-applications-to-use-cpu-pools">4.2.3. Guidelines for the applications to use CPU pools</a></h4>
<div class="ulist">
<ul>
<li>
<p>100% busy tight loop polling threads with the setting of RT CPU schedule scheduling policy (for example, polling threads less than <code>SCHED_FIFO:10/SCHED_RR</code>) need to implement <code>uSleeps</code> to yield CPU time to other processes or threads.</p>
<div class="ulist">
<ul>
<li>
<p>Sleep duration and periodicity need to be configurable parameters</p>
</li>
<li>
<p>As one of RT-Application on-boarding acceptance criteria, Sleep duration and periodicity will be configured properly to ensure that CaaS platform does not run into stability issues (for example, CPU starvation, process stall).</p>
</li>
</ul>
</div>
</li>
<li>
<p>A cloud native application should be decoupled into multiple small units (for example, a container) to ensure that each unit is running in <strong>only</strong> one type of CPU pool.</p>
<div class="ulist">
<ul>
<li>
<p>If one of the containers in the pod uses guaranteed cpus then all other containers in that pod must be guaranteed <code>qos</code> class as well.</p>
</li>
<li>
<p>The requirement is that the sum of all resources and limits must be equal (Pod QoS Guaranteed) and the pinned containers must use integer (and equal) values for cpu and memory requests and limits. This implies that the non-pinned containers also use requests=limits, but the values can be fractional "2.5" or even whole, but written as fractions eg. "1.0".</p>
</li>
<li>
<p>At least one core must be left for non-guaranteed work loads.</p>
</li>
</ul>
</div>
</li>
<li>
<p>The workload running in the shared CPU pool should choose non-RT CPU schedule policy, like SCHED_OTHER to always share the CPU with other applications and kernel threads.</p>
</li>
<li>
<p>The workload running in Application exclusive CPU pool should choose RT CPU scheduling policy, like <code>SCHED_FIFO/SCHED_RR</code> to archive the low-latency, but should set the priority less than 10 to avoid the CPU starvation of the kernel threads (<code>ksoftirqd SCHED_FIFO:11, ktimer SCHED_FIFO:11, rcuc SCHED_FIFO:11</code>) on the same CPU core.</p>
</li>
<li>
<p>The workload running in Application-isolated exclusive CPU pool should choose RT CPU scheduling policy, like <code>SCHED_FIFO/SCHED_RR</code> and set high priority to achieve the best low-latency performance. The workload should be cpu-pinned on a set of dedicated CPU cores, but periodically yielding CPU (calling the <code>nanosleep</code> function) in its busy tight loop is required to ensure that the kernel threads on the same CPU core can get the minimum CPU time.</p>
</li>
<li>
<p>If a workload with both RT task and non-RT task has to be implemented in one single Pod:</p>
<div class="ulist">
<ul>
<li>
<p>The real-time tasks within the Pod:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Should execute the CPU pinning based on the rule of single thread per logical core</p>
</li>
<li>
<p>Should use RT CPU scheduling policy, like <code>SCHED_FIFO/SCHED_RR</code></p>
</li>
<li>
<p>Can set higher priority, but periodically yielding CPU in its busy tight loop is required (refer to the earlier uSleep requirements).</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
</li>
<li>
<p>The non real time tasks within the Pod:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Should use the CPU cores separated from real time tasks using taskset or pthread_affinity</p>
</li>
<li>
<p>Need to take care of the scheduling/load balancing if the <code>SCHED_OTHER</code> scheduling policy is used</p>
</li>
<li>
<p>Use RT CPU scheduling policy, like SCHED_RR, with lower priority levels, which will be equivalent to SMP configuration of threads running on not-isolcpu cores.</p>
</li>
</ol>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>The above applies for guaranteed and non-guaranteed QoS within a single Pod.</p>
</div>
<div class="paragraph">
<p>It is possible to create a Pod with multiple containers and only pin some of the CPUs.</p>
</div>
<div class="paragraph">
<p>Follow these rules:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Total resource requests must match total limits</p>
</li>
<li>
<p>Pinned containers must request integer number of CPUs</p>
</li>
</ol>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>             <span class="c1"># QoS: Guaranteed</span>
<span class="na">metadata</span><span class="pi">:</span>             <span class="c1"># total requests [id="cnf-best-practices-far-edge-limits"]</span>
<span class="s">= limits</span>
  <span class="s">name</span><span class="err">:</span> <span class="s">guar-2s</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">pinned-1</span>    <span class="c1"># PINNED</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">limits</span><span class="pi">:</span>         <span class="c1"># requests are inferred</span>
        <span class="na">cpu</span><span class="pi">:</span> <span class="m">2</span>        <span class="c1"># integer value</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">400Mi"</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">best-1</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">limits</span><span class="pi">:</span>         <span class="c1"># Burstable</span>
        <span class="na">cpu</span><span class="pi">:</span> <span class="m">0.5</span>      <span class="c1"># non-integer value</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">200Mi"</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">best-2</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">limits</span><span class="pi">:</span>         <span class="c1"># Burstable</span>
        <span class="na">cpu</span><span class="pi">:</span> <span class="m">1.0</span>      <span class="c1"># non-integer value</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">200Mi"</span></code></pre>
</div>
</div>
<div class="ulist">
<ul>
<li>
<p>CNF applications should build resiliency in their pipeline to recover from unexpected outliers in the platform. Applications need to recover without causing the system or application to crash when an outlier is seen (e.g. symbol or TTI dropped).</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-far-edge-huge-pages-allocation"><a class="link" href="#cnf-best-practices-far-edge-huge-pages-allocation">4.3. Huge pages allocation</a></h3>
<div class="paragraph">
<p>Unlike CPU or memory, huge pages do not support overcommit. Huge page requests must equal the limits. Huge pages are isolated at a container scope, so each container has its own limit on their cgroup sandbox as requested in a container spec. Applications that consume huge pages via <code>shmget()</code> with <code>SHM_HUGETLB</code> must run with a supplemental group that matches <code>/proc/sys/vm/hugetlb_shm_group</code>. Huge page usage in a namespace is controllable via ResourceQuota similar to other compute resources like cpu or memory using the hugepages-1Gi token.</p>
</div>
<div class="paragraph">
<p>Please refer to <a href="https://kubernetes.io/docs/tasks/manage-hugepages/scheduling-hugepages/">Manage HugePages</a> for more information.</p>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-far-edge-hardware-acceleration-easic"><a class="link" href="#cnf-best-practices-far-edge-hardware-acceleration-easic">4.4. Hardware acceleration (eASIC)</a></h3>

</div>
<div class="sect2">
<h3 id="cnf-best-practices-far-edge-ptp-synchronization"><a class="link" href="#cnf-best-practices-far-edge-ptp-synchronization">4.5. PTP synchronization</a></h3>
<div class="paragraph">
<p>Network synchronization is key to optimal radio network performance. While there is no change to fundamental synchronization requirements in the move from 4G to 5G, wider use of <em>Time Division Duplex</em> (TDD) radio technology and growing demand for new network architectures that support demanding 5G use cases have made the need for time synchronization more critical in 5G.</p>
</div>
<div class="paragraph">
<p>Precision Timing Protocol (PTP) is used as Transport-based synchronization solutions to provide accurate timing to both platform and application. A hierarchical PTP master-slave architecture is implemented for clock distribution.</p>
</div>
<div class="paragraph">
<p>The IEEE 1588 PTP standards provide a wealth of options and the basis for highly reliable and accurate time synchronization solutions. However, the time synchronization needs of specific applications in different industries can vary quite significantly. These specific needs are defined in separate PTP profile standards, often in collaboration with other industry standards organizations.</p>
</div>
<div class="paragraph">
<p>For 5G, both IEEE and ITU-T provide relevant profiles that can be used to design ultra-reliable and highly accurate time synchronization solutions. The ITU-T PTP Telecom Profiles are:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><strong>G8265.1</strong> was first used to deliver accurate frequency synchronization, but not time::synchronization, to mobile base-stations (as the delay asymmetries and packet delay variation present in PTP-unaware networks would make it impossible to meet the stringent accuracy and stability requirements).</p>
</li>
<li>
<p><strong>G8275.1</strong> is designed to deliver both <span class="underline">highly accurate</span> frequency synchronization,::phase synchronization and Time of Day (ToD) with support for accurate frequency synchronization from the network physical layer. (<strong><em><span class="underline">Recommended one</span></em></strong> but all elements in the network must be PTP-aware).</p>
</li>
<li>
<p><strong>G8275.2</strong> is designed to deliver accurate frequency synchronization, phase synchronization and ToD with only partial support from the network where non-PTP nodes are also in the network path.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The following table shows the relevant options in Telecom profiles:</p>
</div>
<div class="paragraph">
<div class="title">Telecom profile options</div>
<p><span class="image"><img src="images/image1_far_edge.png" alt="image1 far edge" width="577" height="577"></span></p>
</div>
<div class="paragraph">
<p>Typically, a PTP hierarchy has the following high-level components:</p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Grandmaster (GM) clock</dt>
<dd>
<p>This is the primary reference time clock (PRTC) for the entire PTP::network. It usually synchronizes its clock from an external Global Navigation Satellite System (GNSS) source.</p>
</dd>
<dt class="hdlist1">Boundary clock (BC)</dt>
<dd>
<p>This intermediate device has multiple PTP-capable network connections to::synchronize one network segment to another accurately. It synchronizes its clock to a master and serves as a time source for ordinary clocks.</p>
</dd>
<dt class="hdlist1">Ordinary clock (OC)</dt>
<dd>
<p>In contrast to boundary clocks, this device only has a single PTP-capable network connection. Its main function is to synchronize its clock to a master, and in the event of losing the master, it can tolerate a loss of sync source for some period of time.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>OpenShift Container Platform uses the PTP Operator to deploy PTP profiles (through the <code>PTPConfig</code> CR) along with the <code>linuxptp</code> Pod in each of the nodes requiring PTP support. This Pod runs <code>ptp4l</code> and <code>phc2sys</code> programs as containers.</p>
</div>
<div class="paragraph">
<p>The <code>ptp4l</code> program represents the Linux implementation of PTP for the boundary and ordinary clocks. When using hardware timestamping, it directly synchronizes the PTP hardware clock (PHC) present on the NIC to the source clock (PRTC).</p>
</div>
<div class="paragraph">
<p>The <code>phc2sys</code> container is responsible for synchronizing the two available clocks in a cluster node, typically these are the PHC and the system clocks. This program is used when hardware time stamping is configured. In such cases, it synchronizes the system clock from the PTP hardware clock on the defined network interface controller (NIC).</p>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-far-edge-how-to-deploy-and-configure-ptp"><a class="link" href="#cnf-best-practices-far-edge-how-to-deploy-and-configure-ptp">4.5.1. How to deploy and configure PTP</a></h4>
<div class="paragraph">
<p>Before enabling PTP, ensure that NTP is disabled for the required nodes. This can be done by disabling the <code>chrony</code> time service (<code>chronyd</code>) using a <code>MachineConfig</code> custom resource. For more information, see <a href="https://docs.openshift.com/container-platform/latest/post_installation_configuration/machine-configuration-tasks.html#cnf-disable-chronyd_post-install-machine-configuration-tasks">Disabling chrony time service</a>.</p>
</div>
<div class="paragraph">
<p>After disabling the NTP service, the next thing is to properly assign labels to the cluster nodes. Labels ensure that the PTP operator applies PTP profiles to the correct cluster node. The use of labels facilitates in-cluster object searches, which are leveraged by the PTP operator (using a match field) to select the right cluster nodes and configure the <code>ptp4l</code> and <code>phc2sys</code> programs accordingly. See the following examples:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc label node rh-sno-du ptp/boundary-clock<span class="o">=</span><span class="s2">""</span> <span class="c"># &lt;- context: rh-sno-du cluster</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>oc label node rh-sno-ru ptp/ordinary-clock<span class="o">=</span><span class="s2">""</span> <span class="c"># &lt;- context: rh-sno-ru cluster</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>These labels are used by the <code>match</code> field in <code>PtpConfig</code> CR to match a profile to one or more nodes.</p>
</div>
<div class="paragraph">
<p>Configuring PTP is a matter of <a href="https://docs.openshift.com/container-platform/latest/networking/using-ptp.html#install-ptp-operator-cli_using-ptp">installing the PTP Operator</a>, <a href="https://docs.openshift.com/container-platform/latest/networking/using-ptp.html#discover-ptp-devices_using-ptp">selecting a capable NIC using the <code>NodePtpDevice</code> CR</a> and setting up the <code>PtpConfig</code> CR with the appropriate values to work as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>An <a href="https://docs.openshift.com/container-platform/latest/networking/using-ptp.html#configuring-linuxptp-services-as-ordinary-clock_using-ptp">OC in an RU</a></p>
</li>
<li>
<p>A <a href="https://docs.openshift.com/container-platform/latest/networking/using-ptp.html#configuring-linuxptp-services-as-boundary-clock_using-ptp">BC in a vDU</a></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Notice, however, that to fulfill Far Edge requirements regarding low latency the PTP Operator <code>linuxptp</code> services <a href="https://docs.openshift.com/container-platform/latest/networking/using-ptp.html#cnf-configuring-fifo-priority-scheduling-for-ptp_using-ptp">must be set to allow threads to run with a SCHED_FIFO policy</a>.</p>
</div>
<div class="paragraph">
<p>The follow topology illustrates the PTP operator running on cluster nodes where the O-RAN workloads are hosted:</p>
</div>
<div class="paragraph">
<div class="title">Running O-RAN cluster workloads</div>
<p><span class="image"><img src="images/image2_far_edge.png" alt="image2 far edge" width="518" height="408"></span></p>
</div>
<div class="paragraph">
<p>The GM device sends its timestamps downstream and these are received in the boundary clock slave ports of a vDU (denoted in the image with a capital S). These timestamps are then used by the <code>ptp4l</code> program to adjust the local <code>PHC</code> in the corresponding cluster node. This also happens from the vDU master ports toward RU ordinary clocks slave ports.</p>
</div>
<div class="paragraph">
<p>At the same time, the <code>phc2sys</code> process running in both the O-DU and O-RU nodes read the PHC timestamps from the <code>ptp4l</code> program through a shared <a href="https://en.wikipedia.org/wiki/Unix_domain_socket">Unix Domain Socket</a> (UDS) and finally adjusting the <code>SYSTEM_CLOCK</code> offset, as shown in the figure below.</p>
</div>
<div class="paragraph">
<p>This process is continuously repeated keeping all the <code>PHC</code> instances in the O-RAN deployment effectively synchronized to the GNSS source clock, which acts as the GM in this scenario.</p>
</div>
<div class="paragraph">
<p><span class="image"><img src="images/image3_far_edge.png" alt="image3 far edge" width="606" height="419"></span></p>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">Tested hardware</dt>
<dd>
<p>Supported NICs have their own physical on-board clock (known as PHC - PTP Hardware Clock) that is used to hardware-timestamp the incoming and outgoing PTP messages.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>The recommended NICs with hardware PTP support are:</p>
</div>
<table class="tableblock frame-all grid-all stretch">
<colgroup>
<col style="width: 51%;">
<col style="width: 49%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Vendor</th>
<th class="tableblock halign-left valign-top">PTP Profile setting</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intel Columbiaville 800 Series NICs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure <em>boundary_clock_jbod</em> is set to 0.</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Intel Fortville X710 Series NICs</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Ensure <em>boundary_clock_jbod</em> is set to 1.</p></td>
</tr>
</tbody>
</table>
<div class="dlist">
<dl>
<dt class="hdlist1">Fast event detection</dt>
<dd>
<p>Cloud-native applications, such as virtual RAN (vRAN), require quick access to notifications about hardware timing events. This is critical for the proper functioning of the whole Far Edge network. <a href="https://docs.openshift.com/container-platform/latest/networking/using-ptp.html#ptp-hardware-fast-event-notifications-framework">Fast event notifications</a> is a Red Hat framework that enables early warnings on real-time PTP clock synchronization events.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This framework mitigates workload errors by allowing cluster nodes to directly communicate PTP clock sync status to the vRAN application running as part of the DU. These event notifications are available to RAN applications running on the same DU node using a publish/subscribe REST API approach that provides event notifications via a fast messaging bus.</p>
</div>
<div class="paragraph">
<p>Fast event notifications are generated by the PTP Operator in the OpenShift Container Platform for every PTP-capable network interface. Specifically, it uses an AMQP event notification bus provided by the AMQ Interconnect Operator that delivers flexible routing of messages between any AMQP-enabled endpoints. A high-level overview of the PTP fast events framework is below:</p>
</div>
<div class="paragraph">
<div class="title">Overview of the PTP fast events framework</div>
<p><span class="image"><img src="images/image4_far_edge.png" alt="image4 far edge" width="627" height="361"></span></p>
</div>
<div class="paragraph">
<p>From the Openshift PTP perspective, the idea is to <a href="https://docs.openshift.com/container-platform/latest/networking/using-ptp.html#cnf-installing-amq-interconnect-messaging-bus_using-ptp">[install the AMQ Interconnect Operator</a> and configure <a href="https://docs.openshift.com/container-platform/latest/networking/using-ptp.html#cnf-configuring-the-ptp-fast-event-publisher_using-ptp">the PTP Operator</a>.</p>
</div>
<div class="paragraph">
<p>Then, update the <code>PtpConfig</code> CR to include the relevant values in each case (sample values for <code>ptpClockThreshold</code> are shown below):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">ptp.openshift.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">PtpConfig</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">&lt;ptp_config_name&gt;</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">openshift-ptp</span>
<span class="nn">...</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">profile</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">profile1"</span>
      <span class="na">interface</span><span class="pi">:</span> <span class="s2">"</span><span class="s">enp5s0f0"</span>
      <span class="na">ptp4lOpts</span><span class="pi">:</span> <span class="s2">"</span><span class="s">-2</span><span class="nv"> </span><span class="s">-s</span><span class="nv"> </span><span class="s">--summary_interval</span><span class="nv"> </span><span class="s">-4"</span>
      <span class="na">phc2sysOpts</span><span class="pi">:</span> <span class="s2">"</span><span class="s">-a</span><span class="nv"> </span><span class="s">-r</span><span class="nv"> </span><span class="s">-m</span><span class="nv"> </span><span class="s">-n</span><span class="nv"> </span><span class="s">24</span><span class="nv"> </span><span class="s">-N</span><span class="nv"> </span><span class="s">8</span><span class="nv"> </span><span class="s">-R</span><span class="nv"> </span><span class="s">16"</span>
      <span class="na">ptp4lConf</span><span class="pi">:</span> <span class="s2">"</span><span class="s">"</span>
  <span class="na">ptpClockThreshold</span><span class="pi">:</span>
    <span class="na">holdOverTimeout</span><span class="pi">:</span> <span class="m">5</span>
    <span class="na">maxOffsetThreshold</span><span class="pi">:</span> <span class="m">100</span>
    <span class="na">minOffsetThreshold</span><span class="pi">:</span> <span class="s">-100</span></code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If the <code>ptpClockThreshold</code> stanza is not present, default values are applied for the <code>ptpClockThreshold</code> fields.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>The <code>ptpClockThreshold</code> configures how long the PTP operator should wait after losing the PTP master clock signal, triggering that error as a PTP event:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>holdOverTimeout</code> is the time value (in seconds) before the PTP clock event state changes to <code>FREERUN</code>, which means that synchronization from the PTP master clock is lost.</p>
</li>
<li>
<p><code>maxOffsetThreshold</code> and <code>minOffsetThreshold</code> settings configure the offset values (in nanoseconds) that compare against the values for CLOCK_REALTIME (<code>phc2sys</code>) or master offset (<code>ptp4l</code>). When the <code>ptp4l</code> or <code>phc2sys</code> offset value is outside the specified range, the PTP clock state is then set to <code>FREERUN</code>. When the offset value is within this range, the PTP clock state remains set to <code>LOCKED</code>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>From the DU application perspective, a new <code>cloud-event-proxy</code> sidecar container is appended to the DU application Pod that is loosely coupled to the main DU application container on the DU node. It provides an event publishing framework that allows you to subscribe to DU applications to any published PTP event. A detailed explanation of how it works can be found <a href="https://docs.openshift.com/container-platform/latest/networking/using-ptp.html#cnf-about-ptp-fast-event-notifications-framework_using-ptp">here</a>.</p>
</div>
<div class="paragraph">
<p>The steps to get a DU application subscribed are described <a href="https://docs.openshift.com/container-platform/latest/networking/using-ptp.html#cnf-fast-event-notifications-api-refererence_using-ptp">here</a>, along with several examples of use.</p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-cnf-security"><a class="link" href="#cnf-best-practices-cnf-security">4.6. CNF security</a></h3>
<div class="paragraph">
<p>In OCP, it is possible to run privileged containers that have all of the root capabilities on a host machine, allowing the ability to access resources which are not accessible in ordinary containers. This, however, increases the security risk to the whole cluster. Containers should only request those privileges they need to run their legitimate functions. No containers will be allowed to run with full privileges without an exception.</p>
</div>
<div class="paragraph">
<p>The general guidelines are:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Only ask for the necessary privileges and access control settings for your application.</p>
</li>
<li>
<p>If the function required by your CNF can be fulfilled by OCP components, your application should not be requesting escalated privilege to perform this function.</p>
</li>
<li>
<p>Avoid using any host system resource if possible.</p>
</li>
<li>
<p>Leveraging read only root filesystem when possible.</p>
</li>
</ol>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Only ask for the necessary privileges and access control settings for your application</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-security-context-non-root-user-check">access-control-security-context-non-root-user-check</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>If the function required by your CNF can be fulfilled by OCP components, your application should not be
requesting escalated privilege to perform this function.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-security-context-privilege-escalation">access-control-security-context-privilege-escalation</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Avoid using any host system resource.</p>
</div>
<div class="paragraph">
<p>See test cases <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-pod-host-ipc">access-control-pod-host-ipc</a>,
<a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-pod-host-pid">access-control-pod-host-pid</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Do not mount host directories for device access.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-pod-host-path">access-control-pod-host-path</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Do not use host network namespace.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-namespace">access-control-namespace</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>CNFs may not modify the platform in any way.</p>
</div>
<div class="paragraph">
<p>See test cases <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#platform-alteration-base-image">platform-alteration-base-image</a>, <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#platform-alteration-sysctl-config">platform-alteration-sysctl-config</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-far-edge-avoid-accessing-resources-on-the-host"><a class="link" href="#cnf-best-practices-far-edge-avoid-accessing-resources-on-the-host">4.6.1. Avoid accessing resources on the host</a></h4>
<div class="paragraph">
<p>It is not recommended for an application to access the following resources on the host.</p>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-far-edge-avoid-mounting-host-directories-as-volumes"><a class="link" href="#cnf-best-practices-far-edge-avoid-mounting-host-directories-as-volumes">4.6.2. Avoid mounting host directories as volumes</a></h4>
<div class="paragraph">
<p>It is not necessary to mount host /sys/ or host /dev/ directory as a volume in a pod in order to use a network device such as SR-IOV VF. The moving of a network interface into the pod network namespace is done automatically by CNI. Mounting the whole /sys/ or /dev/ directory in the container will overwrite the network device descriptor inside the container which causes 'device not found' or 'no such file or directory' error.</p>
</div>
<div class="paragraph">
<p>Network interface statistics can be queried inside the container using the same /sys/ path as was done when running directly on the host. When running network interfaces in containers, relevant /sys/ statistics interfaces are available inside the container, such as <code>/sys/class/net/net1/statistics/</code>, <code>/proc/net/tcp</code> and <code>/proc/net/tcp6</code>.</p>
</div>
<div class="paragraph">
<p>For running DPDK applications with SR-IOV VF, device specs (in case of vfio-pci) are automatically attached to the container via the Device Plugin. There is no need to mount the <code>/dev/</code> directory as a volume in the container as the application can find device specs under <code>/dev/vfio/</code> in the container.</p>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-far-edge-avoid-the-host-network-namespace"><a class="link" href="#cnf-best-practices-far-edge-avoid-the-host-network-namespace">4.6.3. Avoid the host network namespace</a></h4>
<div class="paragraph">
<p>Application pods must avoid using <code>hostNetwork</code>. Applications may not use the host network, including nodePort for network communication. Any networking needs beyond the functions provided by the pod network ingress/egress proxy must be serviced via a multus connected interface.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Applications may <strong>not</strong> use <code>NodePorts</code> or the <code>hostNetwork</code>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-linux-capabilities"><a class="link" href="#cnf-best-practices-linux-capabilities">4.7. Linux Capabilities</a></h3>
<div class="paragraph">
<p>Linux Capabilities allow you to break apart the power of root into smaller groups of privileges. The <a href="https://man7.org/linux/man-pages/man7/capabilities.7.html">Linux capabilities(7)</a> man page provides a detailed description of how capabilities management is performed in Linux.
In brief, the Linux kernel associates various capability sets with threads and files. The thread’s Effective capability set determines the current privileges of a thread.</p>
</div>
<div class="paragraph">
<p>When a thread executes a binary program the kernel updates the various thread capability sets according to a set of rules that take into account the UID of thread before and after the exec system call and the file capabilities of the program being executed.</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Refer to the <a href="https://linuxera.org/capabilities-seccomp-kubernetes/">blog series for more details about Linux Capabilities and some examples</a>.</p>
</li>
<li>
<p>For Red Hat specific review of Capabilities, see <a href="https://cloud.redhat.com/blog/linux-capabilities-in-openshift">Linux Capabilities in OpenShift</a>.</p>
</li>
<li>
<p>An additional reference is <a href="https://docs.docker.com/engine/reference/run/#runtime-privilege-and-linux-capabilities">Docker run reference</a>.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Users can choose to specify the required permissions for their running application in the Security Context of the pod specification. In OCP, administrators can use the Security Context Constraint (SCC) admission controller plugin to control the permissions allowed for pods deployed to the cluster. If the pod requests permissions that are not allowed by the SCCs available to that pod, the pod will not be admitted to the cluster.</p>
</div>
<div class="paragraph">
<p>The following runtime and SCC attributes control the capabilities that will be granted to a new container:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>The capabilities granted to the CRI-O engine. The default capabilities are listed here: <a href="https://github.com/cri-o/cri-o/blob/master/internal/config/capabilities/capabilities.go" class="bare">https://github.com/cri-o/cri-o/blob/master/internal/config/capabilities/capabilities.go</a></p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>As of Kubernetes version 1.18, CRI-O no longer runs with NET_RAW or SYS_CHROOT by default.
See <a href="https://cri-o.github.io/cri-o/v1.18.0.html">CRI-O v1.18.0</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>The values in the SCC for <code>allowedCapabilities</code>, <code>defaultAddCapabilities</code> and <code>requiredDropCapabilities</code></p>
</li>
<li>
<p><code>allowPrivilegeEscalation</code>: controls whether a container can acquire extra privileges through setuid binaries or the file capabilities of binaries</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>The capabilities associated with a new container are determined as follows:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>If the container has the UID 0 (root) its Effective capability set is determined according to the capability attributes requested by the pod or container security context and allowed by the SCC assigned to the pod. In this case, the SCC provides a way to limit the capabilities of a root container.</p>
</li>
<li>
<p>If the container has a UID non 0 (non root), the new container has an empty Effective capability set (see <a href="https://github.com/kubernetes/kubernetes/issues/56374#">#56374</a>). In this case the SCC assigned to the pod controls only the capabilities the container may acquire through the file capabilities of binaries it will execute.</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Considering the general recommendation to avoid running root containers, capabilities required by non-root containers are controlled by the pod or container security context and the SCC capability attributes but can only be acquired by properly setting the file capabilities of the container binaries.</p>
</div>
<div class="paragraph">
<p>Refer to <a href="https://docs.openshift.com/container-platform/latest/authentication/managing-security-context-constraints.html">Managing security context constraints</a> for more details on how to define and use the SCC.</p>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-default-capabilities"><a class="link" href="#cnf-best-practices-default-capabilities">4.7.1. DEFAULT capabilities</a></h4>
<div class="paragraph">
<p>The default capabilities that are allowed via the restricted SCC are as follows. <a href="https://github.com/cri-o/cri-o/blob/master/internal/config/capabilities/capabilities.go" class="bare">https://github.com/cri-o/cri-o/blob/master/internal/config/capabilities/capabilities.go</a></p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>"CHOWN"</code></p>
</li>
<li>
<p><code>"DAC_OVERRIDE"</code></p>
</li>
<li>
<p><code>"FSETID"</code></p>
</li>
<li>
<p><code>"FOWNER"</code></p>
</li>
<li>
<p><code>"SETPCAP"</code></p>
</li>
<li>
<p><code>"NET_BIND_SERVICE"</code></p>
</li>
</ul>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>The capabilities: "SETGID", "SETUID" &amp;"KILL", have been removed from the default OpenShift capabilities.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-ipc_lock"><a class="link" href="#cnf-best-practices-ipc_lock">4.7.2. IPC_LOCK</a></h4>
<div class="paragraph">
<p>IPC_LOCK capability is required if any of these functions are used in an application:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>mlock()</code></p>
</li>
<li>
<p><code>mlockall()</code></p>
</li>
<li>
<p><code>shmctl()</code></p>
</li>
<li>
<p><code>mmap()</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>Even though <code>mlock()</code> is not necessary on systems where page swap is disabled (for example on OpenShift), it may still be required as it is a function that is built into DPDK libraries, and DPDK based applications may indirectly call it by calling other functions.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-ipc-lock-capability-check">access-control-ipc-lock-capability-check</a></p>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-net_admin"><a class="link" href="#cnf-best-practices-net_admin">4.7.3. NET_ADMIN</a></h4>
<div class="paragraph">
<p>NET_ADMIN capability is required to perform various network related administrative operations inside container such as:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>MTU setting</p>
</li>
<li>
<p>Link state modification</p>
</li>
<li>
<p>MAC/IP address assignment</p>
</li>
<li>
<p>IP address flushing</p>
</li>
<li>
<p>Route insertion/deletion/replacement</p>
</li>
<li>
<p>Control network driver and hardware settings via <code>ethtool</code></p>
</li>
</ul>
</div>
<div class="paragraph">
<p>This doesn&#8217;t include:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>add/delete a virtual interface inside a container. For example: adding a VLAN interface</p>
</li>
<li>
<p>Setting VF device properties</p>
</li>
</ul>
</div>
<div class="paragraph">
<p>All the administrative operations (except <code>ethtool</code>) mentioned above that require the <code>NET_ADMIN</code> capability should already be supported on the host by various CNIs in Openshift.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Only userplane applications or applications using SR-IOV or Multicast can request NET_ADMIN capability</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-net-admin-capability-check">access-control-net-admin-capability-check</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-avoid-sys_admin"><a class="link" href="#cnf-best-practices-avoid-sys_admin">4.7.4. Avoid SYS_ADMIN</a></h4>
<div class="paragraph">
<p>This capability is very powerful and overloaded. It allows the application to perform a range of system administration operations to the host. So you should avoid requiring this capability in your application.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Applications <strong>MUST NOT</strong> use the SYS_ADMIN Linux capability</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-sys-admin-capability-check">access-control-sys-admin-capability-check</a></p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-sys_nice"><a class="link" href="#cnf-best-practices-sys_nice">4.7.5. SYS_NICE</a></h4>
<div class="paragraph">
<p>In the case that a CNF is running on a node using the real-time kernel, SYS_NICE will be used to allow DPDK application to switch to SCHED_FIFO.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-sys-nice-realtime-capability">access-control-sys-nice-realtime-capability</a></p>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-sys_ptrace"><a class="link" href="#cnf-best-practices-sys_ptrace">4.7.6. SYS_PTRACE</a></h4>
<div class="paragraph">
<p>This capability is required when using Process Namespace Sharing. This is used when processes from one Container need to be exposed to another Container. For example, to send signals like SIGHUP from a process in a Container to another process in another Container. See <a href="https://kubernetes.io/docs/tasks/configure-pod-container/share-process-namespace/">Share Process Namespace between Containers in a Pod</a> for more details.
For more information on these capabilities refer to <a href="https://cloud.redhat.com/blog/linux-capabilities-in-openshift">Linux Capabilities in OpenShift</a>.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#access-control-sys-ptrace-capability">access-control-sys-ptrace-capability</a></p>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-openshift-operations"><a class="link" href="#cnf-best-practices-openshift-operations">4.8. Operations that shall be executed by OpenShift</a></h3>
<div class="paragraph">
<p>The application should not require <code>NET_ADMIN</code> capability to perform the following administrative operations:</p>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-mtu-setting"><a class="link" href="#cnf-best-practices-mtu-setting">4.8.1. Setting the MTU</a></h4>
<div class="ulist">
<ul>
<li>
<p>Configure the MTU for the cluster network, also known as the OVN or Openshift-SDN network, by modifying the manifests generated by <code>openshift-installer</code> before deploying the cluster. See <a href="https://docs.openshift.com/container-platform/latest/networking/changing-cluster-network-mtu.html">Changing the MTU for the cluster network</a> for more information.</p>
</li>
<li>
<p>Configure additional networks managed by the Cluster Network Operator by using <code>NetworkAttachmentDefinition</code> resources generated by the Cluster Network Operator. See <a href="https://docs.openshift.com/container-platform/latest/networking/hardware_networks/using-sriov-multicast.html">Using high performance multicast</a> for more information.</p>
</li>
<li>
<p>Configure SR-IOV interfaces by using the SR-IOV Network Operator, see <a href="https://docs.openshift.com/container-platform/latest/networking/hardware_networks/configuring-sriov-device.html">Configuring an SR-IOV network device</a> for more information.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-link-state-modification"><a class="link" href="#cnf-best-practices-link-state-modification">4.8.2. Modifying link state</a></h4>
<div class="ulist">
<ul>
<li>
<p>All the links should be set up before attaching it to a pod.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-ip/mac-address-assignment"><a class="link" href="#cnf-best-practices-ip/mac-address-assignment">4.8.3. Assigning IP/MAC addresses</a></h4>
<div class="ulist">
<ul>
<li>
<p>For all the networks, the IP/MAC address should be assigned to the interface during pod creation.</p>
</li>
<li>
<p>MULTUS also allows users to override the IP/MAC address. Refer to <a href="https://docs.openshift.com/container-platform/latest/networking/multiple_networks/attaching-pod.html">Attaching a pod to an additional network</a> for more information.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-manipulate-pod’s-route-table"><a class="link" href="#cnf-best-practices-manipulate-pod’s-route-table">4.8.4. Manipulating pod route tables</a></h4>
<div class="ulist">
<ul>
<li>
<p>By default, the default route of the pod will point to the cluster network, with or without the additional networks. MULTUS also allows users to override the default route of the pod. Refer to <a href="https://docs.openshift.com/container-platform/latest/networking/multiple_networks/attaching-pod.html">Attaching a pod to an additional network</a> for more information.</p>
</li>
<li>
<p>Non-default routes can be added to pod routing tables by various IPAM CNI plugins during pod creation.</p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-sr/iov-vf-setting"><a class="link" href="#cnf-best-practices-sr/iov-vf-setting">4.8.5. Setting SR/IOV VFs</a></h4>
<div class="paragraph">
<p>The SR-IOV Network Operator also supports configuring the following parameters for SR-IOV VFs. Refer to <a href="https://docs.openshift.com/container-platform/latest/networking/hardware_networks/configuring-sriov-net-attach.html">Configuring an SR-IOV Ethernet network attachment</a> for more information.</p>
</div>
<div class="ulist">
<ul>
<li>
<p><code>vlan</code></p>
</li>
<li>
<p><code>linkState</code></p>
</li>
<li>
<p><code>maxTxRate</code></p>
</li>
<li>
<p><code>minRxRate</code></p>
</li>
<li>
<p><code>vlanQoS</code></p>
</li>
<li>
<p><code>spoofChk</code></p>
</li>
<li>
<p><code>trust</code></p>
</li>
</ul>
</div>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-multicast"><a class="link" href="#cnf-best-practices-multicast">4.8.6. Configuring multicast</a></h4>
<div class="paragraph">
<p>In OpenShift, multicast is supported for both the default interface (OVN or OpenShift-SDN) and the additional interfaces such as macvlan, SR-IOV, etc. Multicast is disabled by default. To enable it, refer to the following procedures:</p>
</div>
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/networking/openshift_sdn/enabling-multicast.html">Enabling multicast for a project</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/networking/hardware_networks/using-sriov-multicast.html#nw-using-an-sriov-interface-for-multicast_using-sriov-multicast">Configuring an SR-IOV interface for multicast</a></p>
</li>
<li>
<p>If your application works as a multicast source and you want to utilize the additional interfaces to carry the multicast traffic, then you don’t need the <code>NET_ADMIN</code> capability. Follow the instructions in <a href="https://docs.openshift.com/container-platform/latest/networking/hardware_networks/using-sriov-multicast.html">Using high performance multicast</a> to set the correct multicast route in the pod’s routing table.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-operations-that-can-not-be-executed-by-openshift"><a class="link" href="#cnf-best-practices-operations-that-can-not-be-executed-by-openshift">4.9. Operations that can not be executed by OpenShift</a></h3>
<div class="paragraph">
<p>All the CNI plugins are only invoked during pod creation and deletion. If your CNF needs perform any operations mentioned above at runtime, the <code>NET_ADMIN</code> capability is required.</p>
</div>
<div class="paragraph">
<p>There are some other functionalities that are not currently supported by any of the OpenShift components which also require <code>NET_ADMIN</code> capability:</p>
</div>
<div class="ulist">
<ul>
<li>
<p>Link state modification at runtime</p>
</li>
<li>
<p>IP/MAC modification at runtime</p>
</li>
<li>
<p>Manipulate pod’s route table or firewall rules at runtime</p>
</li>
<li>
<p>SR/IOV VF setting at runtime</p>
</li>
<li>
<p>Netlink configuration</p>
</li>
<li>
<p>For example, <code>ethtool</code> can be used to configure things like rxvlan, txvlan, gso, tso, etc.</p>
</li>
<li>
<p>Multicast</p>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If your application works as a receiving member of IGMP groups, you need to specify the NET_ADMIN capability in the pod manifest. So that the app is allowed to assign multicast addresses to the pod interface and join an IGMP group.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Set <code>SO_PRIORITY</code> to a socket to manipulate the 802.1p priority in ethernet frames</p>
</li>
<li>
<p>Set <code>IP_TOS</code> to a socket to manipulate the DSCP value of IP packets</p>
</li>
</ul>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-analyzing-your-application"><a class="link" href="#cnf-best-practices-analyzing-your-application">4.10. Analyzing your application</a></h3>
<div class="paragraph">
<p>To find out which capabilities the application needs, Red Hat has developed a SystemTap script (<code>container_check.stp</code>). With this tool, the CNF developer can find out what capabilities an application requires in order to run in a container. It also shows the syscalls which were invoked. Find more info at <a href="https://linuxera.org/capabilities-seccomp-kubernetes/" class="bare">https://linuxera.org/capabilities-seccomp-kubernetes/</a></p>
</div>
<div class="paragraph">
<p>Another tool is <code>capable</code> which is part of the BCC tools. It can be installed on RHEL8 with <code>dnf install bcc</code>.</p>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-finding-the-capabilities-that-an-application-needs"><a class="link" href="#cnf-best-practices-finding-the-capabilities-that-an-application-needs">4.11. Finding the capabilities that an application needs</a></h3>
<div class="paragraph">
<p>Here is an example of how to find out the capabilities that an application needs. <code>testpmd</code> is a DPDK based layer-2 forwarding application. It needs the <code>CAP_IPC_LOCK</code> to allocate the hugepage memory.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use container_check.stp. We can see <code>CAP_IPC_LOCK</code> and <code>CAP_SYS_RAWIO</code> are requested by <code>testpmd</code> and the relevant syscalls.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span><span class="nv">$ </span>/usr/share/systemtap/examples/profiling/container_check.stp <span class="nt">-c</span> <span class="s1">'testpmd -l 1-2 -w 0000:00:09.0 -- -a --portmask=0x8 --nb-cores=1'</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="go">[...]
capabilities used by executables
    executable:   prob capability
    testpmd:      cap_ipc_lock
    testpmd:      cap_sys_rawio

capabilities used by syscalls
    executable,   syscall ( capability )    : count
    testpmd,      mlockall ( cap_ipc_lock ) : 1
    testpmd,      mmap ( cap_ipc_lock )     : 710
    testpmd,      open ( cap_sys_rawio )    : 1
    testpmd,      iopl ( cap_sys_rawio )    : 1

failed syscalls
    executable,          syscall =       errno:   count
    eal-intr-thread,  epoll_wait =       EINTR:       1
    lcore-slave-2,          read =            :       1
    rte_mp_handle,       recvmsg =            :       1
    stapio,                      =       EINTR:       1
    stapio,               execve =      ENOENT:       3
    stapio,        rt_sigsuspend =            :       1
    testpmd,               flock =      EAGAIN:       5
    testpmd,                stat =      ENOENT:      10
    testpmd,               mkdir =      EEXIST:       2
    testpmd,            readlink =      ENOENT:       3
    testpmd,              access =      ENOENT:    1141
    testpmd,              openat =      ENOENT:       1
    testpmd,                open =      ENOENT:      13
    [...]</span></code></pre>
</div>
</div>
</li>
<li>
<p>Use the <code>capable</code> command:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>/usr/share/bcc/tools/capable</code></pre>
</div>
</div>
</li>
<li>
<p>Start the testpmd application from another terminal, and send some test traffic to it. For example:</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>testpmd <span class="nt">-l</span> 18-19 <span class="nt">-w</span> 0000:01:00.0 <span class="nt">--</span> <span class="nt">-a</span> <span class="nt">--portmask</span><span class="o">=</span>0x1 <span class="nt">--nb-cores</span><span class="o">=</span>1</code></pre>
</div>
</div>
</li>
<li>
<p>Check the output of the <code>capable</code> command. Below, <code>CAP_IPC_LOCK</code> was requested for running <code>testpmd</code>.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="go">[...]
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
0:41:58 0 3591  testpmd CAP_IPC_LOCK  1
[...]</span></code></pre>
</div>
</div>
</li>
<li>
<p>Also, try to run <code>testpmd</code> without <code>CAP_IPC_LOCK</code> set with <code>capsh</code>. Now we can see that the hugepage memory cannot be allocated.</p>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="gp">$</span><span class="w"> </span>capsh <span class="nt">--drop</span><span class="o">=</span>cap_ipc_lock <span class="nt">--</span> <span class="nt">-c</span> testpmd <span class="nt">-l</span> 18-19 <span class="nt">-w</span> 0000:01:00.0 <span class="nt">--</span> <span class="nt">-a</span> <span class="nt">--portmask</span><span class="o">=</span>0x1 <span class="nt">--nb-cores</span><span class="o">=</span>1</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Example output</div>
<div class="content">
<pre class="rouge highlight"><code data-lang="terminal"><span class="go">EAL: Detected 24 lcore(s)
EAL: Detected 2 NUMA nodes
EAL: Multi-process socket /var/run/dpdk/rte/mp_socket
EAL: No free hugepages reported in hugepages-1048576kB
EAL: Probing VFIO support...
EAL: VFIO support initialized
EAL: PCI device 0000:01:00.0 on NUMA socket 0
EAL: probe driver: 8086:10fb net_ixgbe
EAL: using IOMMU type 1 (Type 1)
EAL: Ignore mapping IO port bar(2)
EAL: PCI device 0000:01:00.1 on NUMA socket 0
EAL: probe driver: 8086:10fb net_ixgbe
EAL: PCI device 0000:07:00.0 on NUMA socket 0
EAL: probe driver: 8086:1521 net_e1000_igb
EAL: PCI device 0000:07:00.1 on NUMA socket 0
EAL: probe driver: 8086:1521 net_e1000_igb
</span><span class="gp">EAL: cannot set up DMA remapping, error 12 (Cannot allocate memory) testpmd: mlockall() failed with error "Cannot allocate memory" testpmd: create a new mbuf pool &lt;mbuf_pool_socket_0&gt;</span>: <span class="nv">n</span><span class="o">=</span>331456, <span class="nv">size</span><span class="o">=</span>2176, <span class="nv">socket</span><span class="o">=</span>0
<span class="go">testpmd: preferred mempool ops selected: ring_mp_mc
</span><span class="gp">EAL: cannot set up DMA remapping, error 12 (Cannot allocate memory) testpmd: create a new mbuf pool &lt;mbuf_pool_socket_1&gt;</span>: <span class="nv">n</span><span class="o">=</span>331456, <span class="nv">size</span><span class="o">=</span>2176,
<span class="go">socket=1
testpmd: preferred mempool ops selected: ring_mp_mc
EAL: cannot set up DMA remapping, error 12 (Cannot allocate memory) EAL: cannot set up DMA remapping, error 12 (Cannot allocate memory)</span></code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-cnf-image-security"><a class="link" href="#cnf-best-practices-cnf-image-security">4.12. Image Security</a></h3>
<div class="paragraph">
<p>Images will be scanned for vulnerabilities during Red Hat certification process.</p>
</div>
<div class="paragraph">
<p>Images must include digital signatures allowing validation that the image is from an authorized vendor, part or all of an authorized CNF delivered by the vendor, has a current component version, and has not been modified since signing. At a minimum, the signature must include information identifying the container base image included as well as for the entire container contents. Accompanying software artifacts such as Helm charts and shell scripts must be similarly signed individually.</p>
</div>
</div>
<div class="sect2">
<h3 id="cnf-best-practices-cnf-securing-cnf-networks"><a class="link" href="#cnf-best-practices-cnf-securing-cnf-networks">4.13. Securing CNF networks</a></h3>
<div class="paragraph">
<p>CNFs must have the least permissions possible and CNFs must implement Network Policies that drop all traffic by default and permit only the relevant ports and protocols to the narrowest ranges of addresses possible.</p>
</div>
<div class="admonitionblock important">
<table>
<tr>
<td class="icon">
<i class="fa icon-important" title="Important"></i>
</td>
<td class="content">
<div class="title">CNF requirement</div>
<div class="paragraph">
<p>Applications must define network policies that permit only the minimum network access the application needs to function.</p>
</div>
<div class="paragraph">
<p>See test case <a href="https://github.com/test-network-function/cnf-certification-test/blob/main/CATALOG.md#networking-network-policy-deny-all">networking-network-policy-deny-all</a></p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3">
<h4 id="cnf-best-practices-secrets-management"><a class="link" href="#cnf-best-practices-secrets-management">4.13.1. Managing secrets</a></h4>
<div class="paragraph">
<p>Secrets objects in OpenShift provide a way to hold sensitive information such as passwords, config files and credentials. There are 4 types of secrets; service account, basic auth, ssh auth and TLS. Secrets can be added via deployment configurations or consumed by pods directly. For more information on secrets and examples, see the following documentation.</p>
</div>
<div class="paragraph">
<p><a href="https://docs.openshift.com/container-platform/latest/nodes/pods/nodes-pods-secrets.html">Providing sensitive data to pods</a></p>
</div>
<div class="sect4">
<h5 id="cnf-best-practices-scc-permissions-for-an-application"><a class="link" href="#cnf-best-practices-scc-permissions-for-an-application">4.13.1.1. Setting SCC permissions for applications</a></h5>
<div class="paragraph">
<p>Permissions to use an SCC is done by adding a cluster role that has <em>uses</em> permissions for the SCC and then rolebindings for the users within a namespace to that role for users that need that SCC. Application admins can create their own role/rolebindings to assign permissions to a Service Account.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">rbac.authorization.k8s.io/v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">ClusterRole</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s2">"</span><span class="s">restricted-scc-cat-1-role"</span>
  <span class="na">labels</span><span class="pi">:</span>
    <span class="na">app</span><span class="pi">:</span> <span class="s">some-app</span>
<span class="na">rules</span><span class="pi">:</span>
<span class="pi">-</span> <span class="na">apiGroups</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">security.openshift.io</span>
  <span class="na">resourceNames</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">restricted-cat-1</span>
  <span class="na">resources</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">securitycontextconstraints</span>
  <span class="na">verbs</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="s">use</span></code></pre>
</div>
</div>
</div>
<div class="sect4">
<h5 id="cnf-best-practices-far-edge-scc-application-categories"><a class="link" href="#cnf-best-practices-far-edge-scc-application-categories">4.13.1.2. SCC Application Categories</a></h5>
<div class="dlist">
<dl>
<dt class="hdlist1">CNFs that do not require advanced networking features (Category 1)</dt>
<dd>
<p>This is the default SCC for all users if your namespace does <strong>not</strong> use service mesh.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This kind of CNFs shall:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use the default CNI (OVN) network interface</p>
</li>
<li>
<p>Not request <code>NET_ADMIN</code> or <code>NET_RAW</code> for advanced networking functions</p>
</li>
</ol>
</div>
<div class="paragraph">
<p>SCC definition (default):</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">kind</span><span class="pi">:</span> <span class="s">SecurityContextConstraints</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">security.openshift.io/v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">restricted-cat-1</span>
<span class="na">users</span><span class="pi">:</span> <span class="pi">[]</span>
<span class="na">groups</span><span class="pi">:</span> <span class="pi">[]</span>
<span class="na">priority</span><span class="pi">:</span> <span class="kc">null</span>
<span class="na">allowHostDirVolumePlugin</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowHostIPC</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowHostNetwork</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowHostPID</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowHostPorts</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowPrivilegeEscalation</span><span class="pi">:</span> <span class="kc">true</span>
<span class="na">allowPrivilegedContainer</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowedCapabilities</span><span class="pi">:</span> <span class="kc">null</span>
<span class="na">defaultAddCapabilities</span><span class="pi">:</span> <span class="kc">null</span>
<span class="na">requiredDropCapabilities</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">KILL</span>
  <span class="pi">-</span> <span class="s">MKNOD</span>
  <span class="pi">-</span> <span class="s">SETUID</span>
  <span class="pi">-</span> <span class="s">SETGID</span>
  <span class="pi">-</span> <span class="s">NET_RAW</span>
<span class="na">fsGroup</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">MustRunAs</span>
<span class="na">readOnlyRootFilesystem</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">runAsUser</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">MustRunAsRange</span>
<span class="na">seLinuxContext</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">MustRunAs</span>
<span class="na">supplementalGroups</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">RunAsAny</span>
<span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">configMap</span>
  <span class="pi">-</span> <span class="s">downwardAPI</span>
  <span class="pi">-</span> <span class="s">emptyDir</span>
  <span class="pi">-</span> <span class="s">persistentVolumeClaim</span>
  <span class="pi">-</span> <span class="s">projected</span>
  <span class="pi">-</span> <span class="s">secret</span></code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">CNFs that require Service Mesh (Category 1 - no-uid0)</dt>
<dd>
<p>CNFs that utilize Service Mesh sidecars for mTLS and load balancing features must utilize an alternative to the restricted SCC Category 1 defined in section “SCC Application Categories” due to Service Mesh limitation around requirements to use a specific UID (1337). An alternate SCC called restricted-no-uid0 has been provided in the platform and is available to all tenants without special requests necessary.</p>
</dd>
</dl>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">kind</span><span class="pi">:</span> <span class="s">SecurityContextConstraints</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">security.openshift.io/v1</span>
<span class="na">name</span><span class="pi">:</span> <span class="s">restricted-no-uid0</span>
<span class="na">allowHostDirVolumePlugin</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowHostIPC</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowHostNetwork</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowHostPID</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowHostPorts</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowPrivilegeEscalation</span><span class="pi">:</span> <span class="kc">true</span>
<span class="na">allowPrivilegedContainer</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowedCapabilities</span><span class="pi">:</span> <span class="kc">null</span>
<span class="na">defaultAddCapabilities</span><span class="pi">:</span> <span class="kc">null</span>
<span class="na">fsGroup</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">RunAsAny</span>
<span class="na">groups</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">system:authenticated</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">annotations</span><span class="pi">:</span>
<span class="na">priority</span><span class="pi">:</span> <span class="kc">null</span>
<span class="na">readOnlyRootFilesystem</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">requiredDropCapabilities</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">KILL</span>
  <span class="pi">-</span> <span class="s">MKNOD</span>
  <span class="pi">-</span> <span class="s">SETUID</span>
  <span class="pi">-</span> <span class="s">SETGID</span>
<span class="na">runAsUser</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">MustRunAsNonRoot</span>
<span class="na">seLinuxContext</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">MustRunAs</span>
<span class="na">supplementalGroups</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">RunAsAny</span>
<span class="na">users</span><span class="pi">:</span> <span class="pi">[]</span>
<span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">configMap</span>
  <span class="pi">-</span> <span class="s">downwardAPI</span>
  <span class="pi">-</span> <span class="s">emptyDir</span>
  <span class="pi">-</span> <span class="s">persistentVolumeClaim</span>
  <span class="pi">-</span> <span class="s">projected</span>
  <span class="pi">-</span> <span class="s">secret</span></code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">CNFs that require advanced networking features (Category 2)</dt>
<dd>
<p>CNFs with following characteristics may fall into this category:</p>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Manipulate the low-level protocol flags, such as the 802.1p priority, VLAN tag, DSCP value, etc.</p>
</li>
<li>
<p>Manipulate the interface IP addresses or the routing table or the firewall rules on-the-fly.</p>
</li>
<li>
<p>Process Ethernet packets</p>
</li>
</ol>
</div>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This kind of CNF may:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use Macvlan interface to sending and receiving Ethernet packets</p>
</li>
<li>
<p>Request CAP_NET_RAW for creating raw sockets</p>
</li>
<li>
<p>Request CAP_NET_ADMIN for</p>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>Modify the interface IP address on-the-fly</p>
</li>
<li>
<p>Manipulating the routing table on-the-fly</p>
</li>
<li>
<p>Manipulating firewall rules on-the-fly.</p>
</li>
<li>
<p>Setting packet DSCP value</p>
</li>
</ol>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Recommended SCC definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">kind</span><span class="pi">:</span> <span class="s">SecurityContextConstraints</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">security.openshift.io/v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">cnf-catalog-2</span>
<span class="na">users</span><span class="pi">:</span> <span class="pi">[]</span>
<span class="na">groups</span><span class="pi">:</span> <span class="pi">[]</span>
<span class="na">priority</span><span class="pi">:</span> <span class="kc">null</span>
<span class="na">allowHostDirVolumePlugin</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowHostIPC</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowHostNetwork</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowHostPID</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowHostPorts</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowPrivilegeEscalation</span><span class="pi">:</span> <span class="kc">true</span>
<span class="na">allowPrivilegedContainer</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowedCapabilities</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">NET_ADMIN</span><span class="pi">,</span> <span class="nv">NET_RAW</span><span class="pi">]</span>
<span class="na">defaultAddCapabilities</span><span class="pi">:</span> <span class="kc">null</span>
<span class="na">requiredDropCapabilities</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">KILL</span>
  <span class="pi">-</span> <span class="s">MKNOD</span>
  <span class="pi">-</span> <span class="s">SETUID</span>
  <span class="pi">-</span> <span class="s">SETGID</span>
<span class="na">fsGroup</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">MustRunAs</span>
<span class="na">readOnlyRootFilesystem</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">runAsUser</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">MustRunAsRange</span>
<span class="na">seLinuxContext</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">MustRunAs</span>
<span class="na">supplementalGroups</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">RunAsAny</span>
<span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">configMap</span>
  <span class="pi">-</span> <span class="s">downwardAPI</span>
  <span class="pi">-</span> <span class="s">emptyDir</span>
  <span class="pi">-</span> <span class="s">persistentVolumeClaim</span>
  <span class="pi">-</span> <span class="s">projected</span>
  <span class="pi">-</span> <span class="s">secret</span></code></pre>
</div>
</div>
<div class="dlist">
<dl>
<dt class="hdlist1">User-Plane CNFs (Category 3)</dt>
<dd>
<p>A CNF which handles user plane traffic or latency-sensitive payloads at line rate falls into this category, such as load balancing, routing, deep packet inspection, and so on. Some of these CNFs may also need to process the packets at a lower level.</p>
</dd>
</dl>
</div>
<div class="paragraph">
<p>This kind of CNF shall:</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Use SR-IOV interfaces</p>
</li>
<li>
<p>Fully or partially bypassing the kernel networking stack with userspace networking technologies, like DPDK, F-stack, VPP, OpenFastPath, etc. A userspace networking stack can not only improve the performance but also reduce the need for the <code>CAP_NET_ADMIN</code> and <code>CAP_NET_RAW</code>.</p>
</li>
</ol>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>For Mellanox devices, those capabilities are requested if the application needs to configure the device (<code>CAP_NET_ADMIN</code>) and/or allocate raw ethernet queue through kernel drive (<code>CAP_NET_RAW</code>).</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph">
<p>As <code>CAP_IPC_LOCK</code> is mandatory for allocating hugepage memory, this capability shall be granted to the DPDK based applications. Additionally if the workload is latency-sensitive and needs the determinacy provided by the real-time kernel, the <code>CAP_SYS_NICE</code> would also be required.</p>
</div>
<div class="paragraph">
<p>Here is an example pod manifest for a DPDK application:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">apiVersion</span><span class="pi">:</span> <span class="s">v1</span>
<span class="na">kind</span><span class="pi">:</span> <span class="s">Pod</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">dpdk-app</span>
  <span class="na">namespace</span><span class="pi">:</span> <span class="s">&lt;target_namespace&gt;</span>
  <span class="na">annotations</span><span class="pi">:</span>
    <span class="na">k8s.v1.cni.cncf.io/networks</span><span class="pi">:</span> <span class="s">dpdk-network</span>
<span class="na">spec</span><span class="pi">:</span>
  <span class="na">containers</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">testpmd</span>
    <span class="na">image</span><span class="pi">:</span> <span class="s">&lt;DPDK_image&gt;</span>
    <span class="na">securityContext</span><span class="pi">:</span>
     <span class="na">capabilities</span><span class="pi">:</span>
        <span class="na">add</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">IPC_LOCK"</span><span class="pi">]</span>
    <span class="na">volumeMounts</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">mountPath</span><span class="pi">:</span> <span class="s">/dev/hugepages</span>
      <span class="na">name</span><span class="pi">:</span> <span class="s">hugepage</span>
    <span class="na">resources</span><span class="pi">:</span>
      <span class="na">limits</span><span class="pi">:</span>
        <span class="na">openshift.io/mlxnics</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1"</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1Gi"</span>
        <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">4"</span>
        <span class="na">hugepages-2Mi</span><span class="pi">:</span> <span class="s2">"</span><span class="s">4Gi"</span>
      <span class="na">requests</span><span class="pi">:</span>
        <span class="na">openshift.io/mlxnics</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1"</span>
        <span class="na">memory</span><span class="pi">:</span> <span class="s2">"</span><span class="s">1Gi"</span>
        <span class="na">cpu</span><span class="pi">:</span> <span class="s2">"</span><span class="s">4"</span>
        <span class="na">hugepages-2Mi</span><span class="pi">:</span> <span class="s2">"</span><span class="s">4Gi"</span>
    <span class="na">command</span><span class="pi">:</span> <span class="pi">[</span><span class="s2">"</span><span class="s">sleep"</span><span class="pi">,</span> <span class="s2">"</span><span class="s">infinity"</span><span class="pi">]</span>
  <span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">name</span><span class="pi">:</span> <span class="s">hugepage</span>
    <span class="na">emptyDir</span><span class="pi">:</span>
      <span class="na">medium</span><span class="pi">:</span> <span class="s">HugePages</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>More can be found at <a href="https://docs.google.com/document/d/1QwS5Plr9uMgu9hCKNQdiXpWbC9u7ErpBwr761aJ5-ec/edit#bookmark=id.kql6vaad1cf0">12</a>.</p>
</div>
<div class="paragraph">
<p>Recommended SCC definition:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="yaml"><span class="na">kind</span><span class="pi">:</span> <span class="s">SecurityContextConstraints</span>
<span class="na">apiVersion</span><span class="pi">:</span> <span class="s">security.openshift.io/v1</span>
<span class="na">metadata</span><span class="pi">:</span>
  <span class="na">name</span><span class="pi">:</span> <span class="s">cnf-catalog-3</span>
<span class="na">users</span><span class="pi">:</span> <span class="pi">[]</span>
<span class="na">groups</span><span class="pi">:</span> <span class="pi">[]</span>
<span class="na">priority</span><span class="pi">:</span> <span class="kc">null</span>
<span class="na">allowHostDirVolumePlugin</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowHostIPC</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowHostNetwork</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowHostPID</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowHostPorts</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowPrivilegeEscalation</span><span class="pi">:</span> <span class="kc">true</span>
<span class="na">allowPrivilegedContainer</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">allowedCapabilities</span><span class="pi">:</span> <span class="pi">[</span><span class="nv">IPC_LOCK</span><span class="pi">,</span> <span class="nv">NET_ADMIN</span><span class="pi">,</span> <span class="nv">NET_RAW</span><span class="pi">]</span>
<span class="na">defaultAddCapabilities</span><span class="pi">:</span> <span class="kc">null</span>
<span class="na">requiredDropCapabilities</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">KILL</span>
  <span class="pi">-</span> <span class="s">MKNOD</span>
  <span class="pi">-</span> <span class="s">SETUID</span>
  <span class="pi">-</span> <span class="s">SETGID</span>
<span class="na">fsGroup</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">MustRunAs</span>
<span class="na">readOnlyRootFilesystem</span><span class="pi">:</span> <span class="kc">false</span>
<span class="na">runAsUser</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">MustRunAsRange</span>
<span class="na">seLinuxContext</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">MustRunAs</span>
<span class="na">supplementalGroups</span><span class="pi">:</span>
  <span class="na">type</span><span class="pi">:</span> <span class="s">RunAsAny</span>
<span class="na">volumes</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">configMap</span>
  <span class="pi">-</span> <span class="s">downwardAPI</span>
  <span class="pi">-</span> <span class="s">emptyDir</span>
  <span class="pi">-</span> <span class="s">persistentVolumeClaim</span>
  <span class="pi">-</span> <span class="s">projected</span>
  <span class="pi">-</span> <span class="s">secret</span></code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cnf-best-practices-far-edge-additional-resources"><a class="link" href="#cnf-best-practices-far-edge-additional-resources">5. Additional resources</a></h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/authentication/managing-security-context-constraints.html" class="bare">https://docs.openshift.com/container-platform/latest/authentication/managing-security-context-constraints.html</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/networking/openshift_sdn/enabling-multicast.html" class="bare">https://docs.openshift.com/container-platform/latest/networking/openshift_sdn/enabling-multicast.html</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/networking/hardware_networks/using-sriov-multicast.html" class="bare">https://docs.openshift.com/container-platform/latest/networking/hardware_networks/using-sriov-multicast.html</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/networking/hardware_networks/using-sriov-multicast.html" class="bare">https://docs.openshift.com/container-platform/latest/networking/hardware_networks/using-sriov-multicast.html</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/networking/multiple_networks/understanding-multiple-networks.html" class="bare">https://docs.openshift.com/container-platform/latest/networking/multiple_networks/understanding-multiple-networks.html</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/networking/hardware_networks/configuring-sriov-device.html" class="bare">https://docs.openshift.com/container-platform/latest/networking/hardware_networks/configuring-sriov-device.html</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/networking/multiple_networks/attaching-pod.html#nw-multus-add-pod_attaching-pod" class="bare">https://docs.openshift.com/container-platform/latest/networking/multiple_networks/attaching-pod.html#nw-multus-add-pod_attaching-pod</a></p>
</li>
<li>
<p><a href="https://docs.openshift.com/container-platform/latest/networking/hardware_networks/configuring-sriov-net-attach.html" class="bare">https://docs.openshift.com/container-platform/latest/networking/hardware_networks/configuring-sriov-net-attach.html</a></p>
</li>
<li>
<p><a href="https://kubernetes.io/docs/tasks/configure-pod-container/share-process-namespace/" class="bare">https://kubernetes.io/docs/tasks/configure-pod-container/share-process-namespace/</a></p>
</li>
<li>
<p><a href="https://linuxera.org/capabilities-seccomp-kubernetes/" class="bare">https://linuxera.org/capabilities-seccomp-kubernetes/</a></p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect1">
<h2 id="cnf-best-practices-copyright"><a class="link" href="#cnf-best-practices-copyright">Copyright</a></h2>
<div class="sectionbody">
<div class="paragraph">
<p>© Copyright 2023 Red Hat Inc.</p>
</div>
<div class="paragraph">
<p>All Rights Reserved.</p>
</div>
<div class="paragraph">
<p>Information contained herein is provided AS IS and subject to change without notice.
All trademarks used herein are property of their respective owners.</p>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Version 1.5<br>
Last updated 2023-11-20 21:59:44 UTC
</div>
</div>
<!-- Nav bar -->
<script type="text/javascript">
const navbar = document.querySelector('.navbar');

let currentPosition = window.scrollY;

// Show navbar on page load
window.addEventListener("load", (event) => {
    navbar.classList.add('show');
});

// Show/hide navbar on scroll
window.addEventListener('scroll', () => {
    if (window.scrollY < currentPosition) {
        //scroll up
        navbar.classList.remove('show');
    } else {
        //scroll down
        navbar.classList.add('show');
    }
    currentPosition = window.scrollY;
});

// Hide navbar on click event
document.querySelectorAll('*')
    .forEach(element => element.addEventListener('click', event => {
        currentPosition = window.scrollY;
        navbar.classList.remove('show');
    }))
</script>

<!-- Copy code -->
<script type="text/javascript">
const copyButtonLabel = "Copy";

let blocks = document.querySelectorAll("pre");

blocks.forEach((block) => {
    // Only add button if browser supports Clipboard API
    if (navigator.clipboard) {
        let button = document.createElement("button");

        button.innerText = copyButtonLabel;
        block.appendChild(button);

        button.addEventListener("click", async () => {
            await copyCode(block, button);
        });
    }
});

async function copyCode(block, button) {
    let code = block.querySelector("code");
    let text = code.innerText;

    await navigator.clipboard.writeText(text);

    button.innerText = "Copied!";

    setTimeout(() => {
        button.innerText = copyButtonLabel;
    }, 400);
}
</script>

<!-- Highlight active TOC item -->
<script type="text/javascript">
const anchors = $('body').find('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]');

$(window).scroll(function(){
    var scrollTop = $(document).scrollTop();

    // highlight the last scrolled-to: set everything inactive first
    for (var i = 0; i < anchors.length; i++){
            $('#toc.toc2 a[href="#' + $(anchors[i]).attr('id') + '"]').removeClass('active');
    }

    // then iterate backwards, on the first match highlight it and break
    for (var i = anchors.length-1; i >= 0; i--){
        if (scrollTop > $(anchors[i]).offset().top - 75) {
            $('#toc.toc2 a[href="#' + $(anchors[i]).attr('id') + '"]').addClass('active');
            break;
        }
    }
});
</script>
</body>
</html>